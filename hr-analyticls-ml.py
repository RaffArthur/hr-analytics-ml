#!/usr/bin/env python
# coding: utf-8

# # –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã—Ö ML-–º–æ–¥–µ–ª–µ–π –¥–ª—è –æ—Ç–¥–µ–ª–∞ HR-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏
# ## –í–≤–µ–¥–µ–Ω–∏–µ
# ---
# ### –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è
# ---
# HR-–∫–æ–º–ø–∞–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ HR-–∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö, –≤–∫–ª—é—á–∞—è —É—Ä–æ–≤–µ–Ω—å –∏—Ö —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–æ–π - —ç—Ç–æ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –æ–ø—Ä–æ—Å–æ–≤, –≥–¥–µ –æ—Ü–µ–Ω–∫–∞ –≤–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è –æ—Ç 0 (–ø–æ–ª–Ω–∞—è –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç—å) –¥–æ 1 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç—å)
# 
# –í —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ—à–∏—Ç—å –¥–≤–µ –∫–ª—é—á–µ–≤—ã–µ –∑–∞–¥–∞—á–∏: 
# - –ø–µ—Ä–≤–∞—è ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è —É—Ä–æ–≤–Ω—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–º–µ—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö
# - –≤—Ç–æ—Ä–∞—è ‚Äî –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–æ–¥–µ–ª—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
# 
# –î–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–µ–Ω –¥–ª—è –±–∏–∑–Ω–µ—Å–∞, –ø–æ—Å–∫–æ–ª—å–∫—É —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–æ–π –Ω–∞–ø—Ä—è–º—É—é –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å –æ—Ç—Ç–æ–∫–æ–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∞, –∞ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤—ã—è–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
# 
# ### –¶–µ–ª—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
# ___
# –¶–µ–ª—å—é –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è –¥–≤–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è:
# 1. –£—Ä–æ–≤–Ω—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ 
# 2. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏–∑ –∫–æ–º–ø–∞–Ω–∏–∏
# 
# ### –û–±—ä–µ–∫—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
# ___
# –ù–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–µ–π —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
# 
# ### –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
# ___
# - –í—ã–±—Ä–∞–Ω–æ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –ø–æ –æ–¥–Ω–æ–π –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ ML —Å–æ–≥–ª–∞—Å–Ω–æ —Ü–µ–ª—è–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
# - –ü–æ –∏—Ç–æ–≥–∞–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–∞–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ –∏ —Å–¥–µ–ª–∞–Ω—ã –≤—ã–≤–æ–¥—ã
# 
# ### –•–æ–¥ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
# ___
# **–î–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–µ–π –±—ã–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –Ω–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö:**
# 
# >- –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:
# > ```python
# > 'test_features.csv' # –í—Ö–æ–¥–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏
# > ```
# >- –î–∞–Ω–Ω—ã–µ –æ–± —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º –∫–ª–∏–º–∞—Ç–æ–º:
# > ```python
# > 'train_job_satisfaction_rate.csv' # –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞
# > 'test_target_job_satisfaction_rate.csv' # –¶–µ–ª–µ–≤–æ–π –ø—Ä–∏–∑–Ω–∞–∫ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏
# > ```
# >- –î–∞–Ω–Ω—ã–µ –æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –∫–æ–º–ø–∞–Ω–∏–∏:
# > ```python
# > 'train_quit.csv.csv' # –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞
# > 'test_target_quit.csv.csv' # –¶–µ–ª–µ–≤–æ–π –ø—Ä–∏–∑–Ω–∞–∫ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏
# > ```
# 
# **–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 4 –±–ª–æ–∫–∞:**
# 
# 1. –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
# 
# > –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∏—Å—Ç–æ—Ç–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç—Å—É—Å—Ç–≤—É–µ—Ç. –ü–æ—ç—Ç–æ–º—É, –≤–Ω–∞—á–∞–ª–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –∏–∑—É—á–µ–Ω—ã –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫, –Ω–µ–¥–æ—á–µ—Ç–æ–≤, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–ª–∏—á–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤. –î–∞–ª–µ–µ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
# 
# 2. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ ML-–º–æ–¥–µ–ª–µ–π
# 
# > –ù–∞ –æ—Å–Ω–æ–≤–µ —É–∂–µ –∏—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã—Ö –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –æ–±—É—á–µ–Ω–æ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ ML-–º–æ–¥–µ–ª–µ–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω–æ –ø–æ –æ–¥–Ω–æ–π –∏–∑ –∫–∞–∂–¥–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å–¥–µ–ª–∞–Ω—ã –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã
#     
# 3. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
# 
# > –ù–∞ –æ—Å–Ω–æ–≤–µ –ª—É—á—à–µ–π –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–æ —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π, –ø—Ä–æ–≤–µ–¥–µ–Ω –∞–Ω–∞–ª–∏–∑ —ç—Ç–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∏ —Å–¥–µ–ª–∞–Ω—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å —ç—Ç–∏–º —Å–µ–≥–º–µ–Ω—Ç–æ–º –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—å—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –¢–∞–∫–∂–µ –±—É–¥—É—Ç —Å–¥–µ–ª–∞–Ω—ã –∏—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Å–µ–≥–º–µ–Ω—Ç—É
#     
# 4. –ó–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–µ –≤—ã–≤–æ–¥—ã
# 
# > –í –∫–æ–Ω—Ü–µ –≤—Å–µ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±—É–¥—É—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∏ –¥–∞–Ω—ã –æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
# 
# **–°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ 7 —ç—Ç–∞–ø–æ–≤:**
# > 1. [X] –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∏–∑—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
# > 2. [X] –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
# > 3. [X] –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
# > 4. [X] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
# > 5. [X] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –æ–±—É—á–µ–Ω–∏–µ ML-–º–æ–¥–µ–ª–µ–π
# > 6. [X] –û—Ç–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ —Å–µ–≥–º–µ–Ω—Ç–∞
# > 7. [X] –ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã

# ## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
# ___

# ### –ò–º–ø–æ—Ä—Ç –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫
# ___

# In[1]:


# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
import os
import warnings

from io import StringIO
from IPython.display import display, Markdown
from joblib import Memory

# –°—Ç–æ—Ä–æ–Ω–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
import matplotlib.pyplot as plt
import numpy as np
import optuna
import pandas as pd
import phik
import seaborn as sns
import shap

from optuna.distributions import (
    CategoricalDistribution,
    IntDistribution,
    FloatDistribution
)
from optuna.integration import OptunaSearchCV
from scipy.stats import ttest_ind
from sklearn.compose import ColumnTransformer
from sklearn.dummy import (
    DummyRegressor,
    DummyClassifier
)
from sklearn.impute import SimpleImputer
from sklearn.inspection import permutation_importance
from sklearn.linear_model import (
    LogisticRegression, 
    LinearRegression
)
from sklearn.metrics import (
    make_scorer,
    roc_auc_score
)
from sklearn.model_selection import (
    GridSearchCV,
    RandomizedSearchCV,
    KFold,
    StratifiedKFold
)
from sklearn.neighbors import (
    KNeighborsClassifier,
    KNeighborsRegressor
)
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import (
    LabelEncoder,
    MinMaxScaler,
    OneHotEncoder,
    OrdinalEncoder,
    PolynomialFeatures,
    RobustScaler,
    StandardScaler,
)
from sklearn.svm import (
    SVR,
    SVC
)
from sklearn.tree import (
    DecisionTreeRegressor,
    DecisionTreeClassifier
)
from tqdm.auto import tqdm
from tqdm_joblib import tqdm_joblib

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª–µ–π
sns.set_style('darkgrid')
pd.set_option('display.float_format', '{:.4f}'.format)
warnings.filterwarnings('ignore')
tqdm.pandas()


# ### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç

# In[2]:


## –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–ª–æ–Ω–æ–∫
##COLS_RENAME_MAP = {
##    'dept': '–û—Ç–¥–µ–ª', 
##    'level': '–£—Ä–æ–≤–µ–Ω—å –≥—Ä–µ–π–¥–∞', 
##    'workload': '–£—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç–∏', 
##    'employment_years': '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã (–ª–µ—Ç)',
##    'last_year_promo': '–ù–∞–ª–∏—á–∏–µ –ø–æ–≤—ã—à–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥.)',
##    'last_year_violations': '–ù–∞–ª–∏—á–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π –¢–î (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥)', 
##    'supervisor_evaluation': '–û—Ü–µ–Ω–∫–∞ —Ä–∞–±–æ—Ç—ã —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º',
##    'salary': '–ó–∞—Ä–ø–ª–∞—Ç–∞ (–º–µ—Å—è—Ü)',
##    'job_satisfaction_rate': '–£—Ä–æ–≤–µ–Ω—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (—Ü–µ–ª–µ–≤–æ–π)',
##    'quit': '–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (—Ü–µ–ª–µ–≤–æ–π)',
##}

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤
FIGSIZE_BAR_PIE = (18, 6)
FIGSIZE_HIST_BOX = (16, 8)
FIGSIZE_HISTPLOT = (16, 12)

PALETTE_CAT = 'coolwarm_r'
PALETTE_NUMERIC = 'Purples'

COLOR_SINGLE = sns.color_palette(PALETTE_NUMERIC)[3]

BINS = 30

X_CAPTION_CAT = '–ó–Ω–∞—á–µ–Ω–∏–µ'
Y_CAPTION_CAT = '–ó–Ω–∞—á–µ–Ω–∏–π (–≤—Å–µ–≥–æ)'

X_CAPTION_NUMERIC = '–ó–Ω–∞—á–µ–Ω–∏–µ'
Y_CAPTION_NUMERIC = '–ß–∞—Å—Ç–æ—Ç–∞'

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è ML
TARGET_JSR = 'job_satisfaction_rate'

TARGET_QUIT = 'quit'

RANDOM_STATE = 42


# ## –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∏–∑—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
# ___

# ### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –∏–∑—É—á–µ–Ω–∏—è

# In[3]:


def load_data(filename, remote_path=None, **params):
    local_file = os.path.join(filename)
    
    if os.path.exists(filename):
        source = local_file
        source_type = '–õ–æ–∫–∞–ª—å–Ω—ã–π'
    else:
        source = f'{remote_path.rstrip("/")}/{filename}'
        source_type = 'URL'

    df = pd.read_csv(source, **params)
    df.attrs['name'] = filename

    display(Markdown(
        f'#### –§–∞–π–ª `{filename}` –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ `{source_type}`\n___'
    ))

    return df


# In[4]:


def get_df_overview(df, discrete=None, section_name=None):
    display(Markdown(f'## üîé –û–±–∑–æ—Ä –¥–∞–Ω–Ω—ã—Ö `{df.attrs["name"]}`\n___'))

    def section(title):
        display(Markdown(f'### {title}\n___\n'))
    
    def show_info():
        section('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ DataFrame')
        buffer = StringIO()
        df.info(buf=buffer)
        info_str = buffer.getvalue()
        display(Markdown(f'```{info_str}```'))
        
    def show_description():
        section('–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö')
        display(df.describe())
        
    def show_sample():
        section('5 —Å–ª—É—á–∞–π–Ω—ã—Ö —Å—Ç—Ä–æ–∫')
        display(df.sample(5))
        
    def show_unique():
        section('–ö–æ–ª-–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π')
        unique_vals = df.nunique().sort_values(ascending=False).to_frame('unique_values')
        display(unique_vals)
        
    def show_missing():
        section('–ö–æ–ª-–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π')
        
        missing = df.isna().sum().to_frame('missing_values')
        missing['missing_pct'] = (missing['missing_values'] / len(df) * 100).round(2)
        
        if missing['missing_values'].sum() == 0:
            display(Markdown('‚úÖ **–ü—Ä–æ–ø—É—Å–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç!**'))
        else:
            display(missing[missing.missing_values != 0])

        
    def show_duplicates_explicit():
        section('–Ø–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã')
        count = df.index.duplicated().sum()
        
        if count == 0:
            display(Markdown('‚úÖ –Ø–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã **–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç!**'))
        else:
            display(Markdown(f'**–ù–∞–π–¥–µ–Ω–æ:** {count}'))
            display(df[df.duplicated()])
            
    def show_duplicates_implicit():
        section('–ù–µ—è–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã')
        
        found = False
        
        for col in df.select_dtypes(include=['object', 'category']):
            vals = df[col].dropna().astype(str)
            normed = vals.str.lower().str.strip()
            rev = vals.groupby(normed).unique()
            
            for norm_val, origs in rev.items():
                if len(origs) > 1:
                    found = True
                    display(Markdown(f'- **{col}**: {list(origs)} ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `{norm_val}`'))
                    
        if not found:
            display(Markdown('‚úÖ –ù–µ—è–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã **–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç!**'))
                    
    def show_fast_plot_analysis(df=df, discrete=discrete):
        section('–ë–µ–≥–ª—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑')
        
        num_cols = [col for col in df.columns if discrete is None or col not in discrete]
        
        if num_cols:
            n_cols = 3
            n_rows = (len(num_cols) + n_cols - 1) // n_cols

            fig, axes = plt.subplots(
                n_rows,
                n_cols,
                figsize=(18, 4 * n_rows)
            )
            
            axes = axes.flatten()

            for col, ax in zip(num_cols, axes):
                sns.histplot(
                    df[col],
                    bins=BINS,
                    color=COLOR_SINGLE,
                    ax=ax
                )
                
                ax.set_xlabel(X_CAPTION_NUMERIC)
                ax.set_ylabel(Y_CAPTION_NUMERIC)
                ax.set_title(col)
                
                for label in ax.get_xticklabels():
                    label.set_rotation(45)
                    
            for ax in axes[len(num_cols):]:
                ax.set_visible(False)

            plt.tight_layout()
            plt.show()

        if discrete:
            n_cols = 3
            n_rows = (len(discrete) + n_cols - 1) // n_cols

            fig, axes = plt.subplots(
                n_rows,
                n_cols,
                figsize=(18, 4 * n_rows)
            )
            
            axes = axes.flatten()

            for col, ax in zip(discrete, axes):
                sns.countplot(
                    x=df[col], 
                    ax=ax, 
                    color=COLOR_SINGLE
                )
                
                ax.set_xlabel(X_CAPTION_NUMERIC)
                ax.set_ylabel(Y_CAPTION_NUMERIC)
                ax.set_title(col)
                
                for label in ax.get_xticklabels():
                    label.set_rotation(45)
            for ax in axes[len(discrete):]:
                ax.set_visible(False)

            plt.tight_layout()
            plt.show()
        
    sections = {
        'info': show_info,
        'description': show_description,
        'sample': show_sample,
        'unique': show_unique,
        'missing': show_missing,
        'duplicates_explicit': show_duplicates_explicit,
        'duplicates_implicit': show_duplicates_implicit,
        'fast_plot_analysis': show_fast_plot_analysis,
    }
        
    if section_name is None:
        for func in sections.values():
            func()
    else:
        func = sections.get(section_name)
        func()


# ### –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

# In[5]:


params = dict(
    sep=',',
    decimal='.',
    index_col='id',
    encoding='utf-8'
)

df_test_features = load_data('test_features.csv', **params)
df_train_job_satisfaction_rate = load_data('train_job_satisfaction_rate.csv', **params)
df_test_job_satisfaction_rate = load_data('test_target_job_satisfaction_rate.csv', **params)
df_train_quit = load_data('train_quit.csv', **params)
df_test_quit = load_data('test_target_quit.csv', **params)


# ### –ò–∑—É—á–µ–Ω–∏–µ `df_test_features`
# ---

# In[6]:


get_df_overview(df_test_features, ['supervisor_evaluation', 'employment_years'])


# ### –ò–∑—É—á–µ–Ω–∏–µ `df_test_job_satisfaction_rate`
# ---

# In[7]:


get_df_overview(df_test_job_satisfaction_rate)


# ### –ò–∑—É—á–µ–Ω–∏–µ `df_train_job_satisfaction_rate`
# ---

# In[8]:


get_df_overview(df_train_job_satisfaction_rate, ['supervisor_evaluation', 'employment_years'])


# ### –ò–∑—É—á–µ–Ω–∏–µ `df_test_quit`
# ---

# In[9]:


get_df_overview(df_test_quit)


# ### –ò–∑—É—á–µ–Ω–∏–µ `df_train_quit`
# ---

# In[10]:


get_df_overview(df_train_quit, ['supervisor_evaluation', 'employment_years'])


# ### –í—ã–≤–æ–¥—ã
# ---
# **–û–±—â–µ–µ –ø–æ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞–º:**
# > - –ù–∞–ª–∏—á–∏–µ —è–≤–Ω—ã—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Å—Ç–æ–∏—Ç –ø—Ä–∏–∑–Ω–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º, —Ç.–∫. –∏—Ö –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –∞–π–¥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞—Ç–∞—Ñ—Ä–µ–π–º—ã —Å —É—á–µ—Ç–æ–º –∏–Ω–¥–µ–∫—Å–æ–≤, —è–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –±—É–¥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å. –¢.–µ. –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —è–≤–ª—è—é—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
# 
# **–î–∞—Ç–∞—Ñ—Ä–µ–π–º: `df_test_features`**
# > - –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ - **`2000x9`**
# > - –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∏ –≤ —Å—Ç–æ–±—Ü–∞—Ö **`'dept' - 2`** –∏ **`'level' - 1`**
# > - –Ø–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã - **`–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç`**
# > - –ù–µ—è–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã - **`–æ—Ç—Å—É—Å—Ç–≤—É—é—Ç`**
# > - –í —Å—Ç–æ–ª–±—Ü–µ **`level`** –æ—à–∏–±–∫–∞ –≤ –Ω–µ–π–º–∏–Ω–≥–µ: **`sinior -> sEnior`**
# > - –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–µ—è–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö **`–¢–∏–ø —Å–µ—Ä–≤–∏—Å–∞`**
# 
# **–î–∞—Ç–∞—Ñ—Ä–µ–π–º: `df_test_job_satisfaction_rate`**
# > - –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ - **`2000x1`**
# > - –ü—Ä–æ–ø—É—Å–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö - **`–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç`**
# > - –Ø–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã - **`–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç`**
# > - –ù–µ—è–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã - **`–æ—Ç—Å—É—Å—Ç–≤—É—é—Ç`**
# 
# **–î–∞—Ç–∞—Ñ—Ä–µ–π–º: `df_train_job_satisfaction_rate`**
# > - –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ - **`4000x10`**
# > - –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∏ –≤ —Å—Ç–æ–±—Ü–∞—Ö **`'dept' - 6`** –∏ **`'level' - 4`**
# > - –Ø–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã - **`–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç`**
# > - –ù–µ—è–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã - **`–æ—Ç—Å—É—Å—Ç–≤—É—é—Ç`**
# > - –í —Å—Ç–æ–ª–±—Ü–µ **`level`** –æ—à–∏–±–∫–∞ –≤ –Ω–µ–π–º–∏–Ω–≥–µ: **`sinior -> sEnior`**
# 
# **–î–∞—Ç–∞—Ñ—Ä–µ–π–º: `df_test_quit`**
# > - –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ - **`2000x1`**
# > - –ü—Ä–æ–ø—É—Å–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö - **`–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç`**
# > - –Ø–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã - **`–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç`**
# > - –ù–µ—è–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã - **`–æ—Ç—Å—É—Å—Ç–≤—É—é—Ç`**
# 
# **–î–∞—Ç–∞—Ñ—Ä–µ–π–º: `df_train_quit`**
# > - –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ - **`4000x10`**
# > - –ü—Ä–æ–ø—É—Å–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö - **`–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç`**
# > - –Ø–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã - **`–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç`**
# > - –ù–µ—è–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã - **`–æ—Ç—Å—É—Å—Ç–≤—É—é—Ç`**
# > - –í —Å—Ç–æ–ª–±—Ü–µ **`level`** –æ—à–∏–±–∫–∞ –≤ –Ω–µ–π–º–∏–Ω–≥–µ: **`sinior -> sEnior`**

# ## –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
# ___

# ### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏
# ___

# In[11]:


def cols_names_cleaner(df):
    df.columns = (
        df
        .columns
        .str.lower()
        .str.replace(' ', '_')
    )
    
    return df


# In[12]:


def text_vals_cleaner(x):
    x = (
        x
        .str.lower()
        .str.replace(' ', '_')
    )
        
    return x


# In[13]:


def text_vals_to_nan(df):
    mask = df.select_dtypes(include=['object', 'category']).columns
    
    before = df[mask].isna().sum()
    
    df[mask] = df[mask].replace(r'^\s*$', np.nan, regex=True)
    
    after = df[mask].isna().sum()
    
    display(Markdown(f'### –ó–Ω–∞—á–µ–Ω–∏–π –Ω–∞–π–¥–µ–Ω–æ –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ NaN:\n___'))
    display(after - before)
    
    return df


# In[14]:


def get_short_df_info(df):
    results = []
   
    for col in df:
        results.append({
            '–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö': df[col].dtype,
            '–£–Ω–∏–∫. –≤—Å–µ–≥–æ.': df[col].nunique(),
            '–£–Ω–∏–∫. –∑–Ω–∞—á–µ–Ω–∏—è': df[col].unique(),
            'NaN (–∫–æ–ª-–≤–æ.)': df[col].isna().sum(),
            'NaN (%)': df[col].isnull().mean().round(4),
        })
        
    main_info = pd.DataFrame(data=results).set_index(df.columns)
    main_info = main_info.style.set_caption(f'–ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º—É \ –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: {df.shape}')
    
    return main_info


# In[15]:


def convert_columns_dtype(df, dtype_mapping):
    for col, dtype in dtype_mapping.items():
        if col in df.columns:
            df[col] = df[col].astype(dtype)
    return df


# ### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–ø–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã
# ___

# In[16]:


test_features_cleaned = df_test_features.copy()
test_features_cleaned.attrs['name'] = 'test_features_cleaned'

train_jsr_cleaned = df_train_job_satisfaction_rate.copy()
train_jsr_cleaned.attrs['name'] = 'train_jsr_cleaned'

test_target_jsr_cleaned = df_test_job_satisfaction_rate.copy()
test_target_jsr_cleaned.attrs['name'] = 'test_target_jsr_cleaned'

train_quit_cleaned = df_train_quit.copy()
train_quit_cleaned.attrs['name'] = 'train_quit_cleaned'

test_target_quit_cleaned = df_test_quit.copy()
test_target_quit_cleaned.attrs['name'] = 'test_target_quit_cleaned'


# ### –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ `test_features_cleaned`
# ---

# In[17]:


# –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞
get_short_df_info(test_features_cleaned)


# In[18]:


# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ NaN
test_features_cleaned = text_vals_to_nan(test_features_cleaned)


# In[19]:


# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≥—Ä–µ–π–¥–∞ –≤ —Å—Ç–æ–ª–±—Ü–µ level
test_features_cleaned.level = (
    test_features_cleaned
    .level
    .replace({'sinior': 'senior'})
)


# In[20]:


# –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É —Ç–∏–ø—É
features_dtype_map = {
    'dept': 'category',
    'level': 'category',
    'workload': 'category',
    'last_year_promo': 'category',
    'last_year_violations': 'category',
    'supervisor_evaluation': 'category',
    'quit': 'category',
}

test_features_cleaned = convert_columns_dtype(test_features_cleaned, features_dtype_map)


# In[21]:


# –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
get_short_df_info(test_features_cleaned)


# ### –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ `train_jsr_cleaned`
# ---

# In[22]:


# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
get_short_df_info(train_jsr_cleaned)


# In[23]:


# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≥—Ä–µ–π–¥–∞ –≤ level
train_jsr_cleaned.level = (
    train_jsr_cleaned
    .level
    .replace({'sinior': 'senior'})
)

get_df_overview(train_jsr_cleaned, section_name= 'duplicates_implicit')


# In[24]:


# –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É —Ç–∏–ø—É
train_jsr_cleaned = convert_columns_dtype(train_jsr_cleaned, features_dtype_map)


# In[25]:


# –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
get_short_df_info(train_jsr_cleaned)


# ### –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ `test_target_jsr_cleaned`
# ---

# In[26]:


# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
get_short_df_info(test_target_jsr_cleaned)


# ### –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ `train_quit_cleaned`
# ---

# In[27]:


# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
get_short_df_info(train_quit_cleaned)


# In[28]:


# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≥—Ä–µ–π–¥–∞ –≤ level
train_quit_cleaned.level = (
    train_quit_cleaned
    .level
    .replace({'sinior': 'senior'})
)

get_df_overview(train_quit_cleaned, section_name= 'duplicates_implicit')


# In[29]:


# –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É —Ç–∏–ø—É
train_quit_cleaned = convert_columns_dtype(train_quit_cleaned, features_dtype_map)


# In[30]:


# –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
get_short_df_info(train_quit_cleaned)


# ### –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ `test_target_quit_cleaned`
# ---

# In[31]:


# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
get_short_df_info(test_target_quit_cleaned)


# In[32]:


# –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É —Ç–∏–ø—É
test_target_quit_cleaned = convert_columns_dtype(test_target_quit_cleaned, features_dtype_map)


# In[33]:


# –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
get_short_df_info(test_target_quit_cleaned)


# ### –í—ã–≤–æ–¥—ã
# ___
# 
# **–û–±—â–µ–µ –ø–æ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞–º**
# > - –ó–Ω–∞—á–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞—Ö –±—ã–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –Ω–∞ —ç—Ç–∞–ø–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
# > - –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –≤ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ senior-–≥—Ä–µ–π–¥–∞) –º–æ–∂–Ω–æ –æ—Ç–Ω–µ—Å—Ç–∏ –∫ –æ–±—ã—á–Ω–æ–π –æ—à–∏–±–∫–µ
# > - –í –æ—Å—Ç–∞–ª—å–Ω–æ–º –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å –¥–æ–≤–æ–ª—å–Ω–æ —á–∏—Å—Ç—ã–º–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª-–≤–æ–º –æ—à–∏–±–æ–∫
# 
# **–î–∞—Ç–∞—Ñ—Ä–µ–π–º: `test_features_cleaned`**
# > - –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö **`'dept', 'level', 'workload', 'last_year_promo', 'last_year_violations', 'supervisor_evaluation'`** –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É —Ç–∏–ø—É **`category`**
# > - –ù–∞–π–¥–µ–Ω—ã –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ NaN: **`'dept' 1, 'workload' 1`**
# 
# **–î–∞—Ç–∞—Ñ—Ä–µ–π–º: `train_jsr_cleaned`**
# > - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≥—Ä–µ–π–¥ –≤ —Å—Ç–æ–ª–±—Ü–µ **`'level'`**: **`sinior -> senior`**
# 
# **–î–∞—Ç–∞—Ñ—Ä–µ–π–º: `test_target_jsr_cleaned`**
# > - –î–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å —á–∏—Å—Ç—ã–º–∏, –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–∞—Å—å
# 
# **–î–∞—Ç–∞—Ñ—Ä–µ–π–º: `train_quit_cleaned`**
# > - –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö **`'dept', 'level', 'workload', 'last_year_promo', 'last_year_violations', 'supervisor_evaluation', 'quit'`** –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É —Ç–∏–ø—É **`category`**
# > - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≥—Ä–µ–π–¥ –≤ —Å—Ç–æ–ª–±—Ü–µ **`'level'`**: **`sinior -> senior`**
# 
# **–î–∞—Ç–∞—Ñ—Ä–µ–π–º: `test_target_quit_cleaned`**
# > - –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö **`'quit'`** –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É —Ç–∏–ø—É **`category`**

# ## –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
# ___

# ### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
# ___

# In[34]:


def display_stats(feature):
    display(feature.describe().to_frame().round(2).T)


# In[35]:


def show_bar_pie_plot(df, x, y=None, hue=None, top_n=5):
    counts = df[x].value_counts()
    top = counts.head(top_n)
    other = counts.iloc[top_n:].sum()
    counts = pd.concat([top, pd.Series({'Other': other})]) if other > 0 else top
    values = counts.values
    categories = counts.index.astype(str).str.capitalize().str.replace('_',' ')
    palette = sns.color_palette(PALETTE_CAT, len(counts))
    suptitle = x.capitalize().replace('_', ' ')
    
    fig, (ax_1, ax_2) = plt.subplots(
        figsize=FIGSIZE_BAR_PIE, 
        ncols=2
    )
    
    sns.barplot(
        x=categories,
        y=values,
        hue=categories,
        palette=palette,
        ax=ax_1
    )

    ax_1.set(
        xlabel=X_CAPTION_CAT,
        ylabel=Y_CAPTION_CAT
    )
    
    for bar in ax_1.containers:
        ax_1.bar_label(bar, padding=3)
        
    ax_2.pie(
        values,
        labels=categories,
        autopct=lambda pct: f'{pct:.1f}%' if pct > 3 else '',
        startangle=90,
        labeldistance=1.1,
        colors=palette,
        wedgeprops={'width': 0.8, 'edgecolor': 'w'},
        pctdistance=0.6
    )
            
    fig.suptitle(
        suptitle, 
        y=1,  
        size=18, 
        weight='bold'
    )
    
    plt.tight_layout()
    plt.show()

    display_stats(df[x])


# In[36]:


def show_hist_box_plot(df, x, y=None, hue=None):
    suptitle = x.capitalize().replace('_', ' ')
    
    fig, (ax_1, ax_2) = plt.subplots(
        figsize=FIGSIZE_HIST_BOX,
        nrows=2
    )
        
    hist_kwargs = dict(
        data=df,
        x=x,
        bins=BINS, 
        kde=True,
        ax=ax_1
    )
    
    box_kwargs = dict(
        data=df,
        x=x,
        orient='h',
        ax=ax_2
    )
    
    if y:
        box_kwargs.update(y=y)
        
    if hue:
        hist_kwargs.update(hue=hue, palette=PALETTE_NUMERIC)
        box_kwargs.update(hue=hue, palette=PALETTE_NUMERIC)
    else:
        hist_kwargs.update(color = COLOR_SINGLE)
        box_kwargs.update(color = COLOR_SINGLE)
        
    sns.histplot(**hist_kwargs)
    sns.boxplot(**box_kwargs)
    
    for ax in (ax_1, ax_2):
        ax.set(
            xlabel=X_CAPTION_NUMERIC,
            ylabel=Y_CAPTION_NUMERIC
        )

    fig.suptitle(
        suptitle, 
        y=1, 
        size=16,
        weight='bold'
    )
    
    plt.tight_layout()
    plt.show()
    
    display_stats(df[x])


# In[37]:


def show_analysis_plot(df, x, y=None, hue=None):
    feature = df[x]
    types = pd.api.types
    is_numeric = types.is_numeric_dtype(feature)
    is_object = types.is_object_dtype(feature)
    is_cat = types.is_categorical_dtype(feature)
    
    if is_numeric:
        return show_hist_box_plot(df, x, y=y, hue=hue)
    elif is_object or is_cat:
        return show_bar_pie_plot(df, x, y=y, hue=hue)

    display_stats(feature)


# In[38]:


def show_full_analysis_plots(df, analysis_type='full'):
    types = pd.api.types
    found_data = False

    for col_name in df.columns:
        col = df[col_name]
        is_numeric_dtype = types.is_numeric_dtype(col)

        should_analyze = (
            analysis_type == 'full'
            or (analysis_type == 'num' and is_numeric_dtype)
            or (analysis_type == 'cat' and not is_numeric_dtype)
        )

        if should_analyze:
            try:
                show_analysis_plot(df, x=col_name)
                found_data = True
            except Exception as e:
                display(Markdown(f"‚ùó –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ **{col_name}**: {e}"))

    if not found_data:
        display(Markdown('‚ÑπÔ∏è –í –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–µ **–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞**'))


# In[39]:


def show_corr_heatmap_plot(corr_matrix, corr_mask):
    fig, ax_1 = plt.subplots(
        figsize=(16, 14),
    )

    sns.heatmap(
        data=corr_matrix,
        mask=corr_mask,
        annot=True,
        cmap='coolwarm',
        cbar=False,
        fmt='.2f',
        vmin=-1,
        vmax=1,
        linewidths=3,
        ax=ax_1
    )

    fig.suptitle(
        '–ú–∞—Ç—Ä–∏—Ü–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ Phi_K',
        y=1,
        size=16,
        weight='bold'
    )

    plt.tight_layout()
    plt.show()


# In[40]:


def get_corr_levels(corr_matrix, corr_mask, target=None):
    levels = {
        1.00: '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è',
        0.70: '–í—ã—Å–æ–∫–∞—è',
        0.50: '–°—Ä–µ–¥–Ω—è—è',
        0.19: '–°–ª–∞–±–∞—è',
        0.00: '–û—á–µ–Ω—å —Å–ª–∞–±–∞—è'
    }
    
    def interpret(value):        
        for (lvl, label) in levels.items():
            if value >= lvl:
                return label
        return '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'
        
    pairs = (
        corr_matrix
        .where(corr_mask.astype(bool))
        .stack()
        .reset_index()
    )
        
    pairs.columns = ['feat_1', 'feat_2', 'corr']
    pairs['corr'] = pairs['corr'].round(2)
    pairs['lvl'] = pairs['corr'].apply(interpret)
    
    if target is not None:        
        target_feature_corr = (
            pairs[(pairs['feat_1'] == target) | (pairs['feat_2'] == target)]
            .sort_values(
                'corr',
                ascending=False)
        )
        
        display(Markdown(f'## –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –ø–æ —Ü–µ–ª–µ–≤–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É: `{target}`\n___\n'))
        
        return target_feature_corr
    else:        
        all_features_corr = pairs.sort_values('corr', ascending=False)
        
        display(Markdown(f'## –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –ø–æ –≤—Å–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º\n___\n'))
        
        return all_features_corr


# In[41]:


def show_scatter_kde_plot(df, x, y, hue=None, alpha=0.6, scatter=True, kde=True):
    counts = df[hue].value_counts()
    palette = sns.color_palette(PALETTE_CAT, len(counts))
    
    fig, (ax_1, ax_2) = plt.subplots(
        figsize=FIGSIZE_HIST_BOX,
        sharex=True,
        sharey=True,
        nrows=2
    )
    
    if hue:
        suptitle = hue.capitalize().replace('_', ' ')
        
        if scatter:
            sns.scatterplot(
                data=df,
                y=y,
                x=x,
                alpha=alpha,
                hue=hue,
                palette=palette,
                ax=ax_1
            )

            sns.lineplot(
                data=df,
                y=y,
                x=x,
                alpha=alpha,
                legend=False,
                hue=hue,
                palette=palette,
                ax=ax_1,
            )
            
        if kde:
            sns.kdeplot(
                data=df,
                y=y,
                x=x,
                hue=hue,
                palette=palette,
                alpha=alpha,
                legend=False,
                fill=True,
                ax=ax_2
            )
    else:
        suptitle = f'{y} vs {x}'.capitalize().replace('_', ' ')
        
        if scatter:
            sns.scatterplot(
                data=df,
                y=y,
                x=x,
                palette=palette,
                legend=False,
                alpha=alpha,
                ax=ax_1
            )

            sns.lineplot(
                data=df,
                y=y,
                x=x,
                palette=palette,
                legend=False,
                alpha=alpha,
                ax=ax_1,
            )
        
        if kde:
            sns.kdeplot(
                data=df,
                y=y,
                x=x,
                palette=palette,
                alpha=alpha,
                legend=False,
                fill=True,
                ax=ax_2
            )
            
    for ax in (ax_1, ax_2):
        ax.set(
            xlabel=X_CAPTION_NUMERIC,
            ylabel=Y_CAPTION_NUMERIC
        )

    fig.suptitle(
        suptitle,
        y=1,
        size=16,
        weight='bold'
    )
    
    plt.tight_layout()
    plt.show()


# In[42]:


def show_compared_histplots(df_1, df_2, features, discrete=None, df1_label='–î–∞—Ç–∞—Å–µ—Ç ‚Ññ1', df2_label='–î–∞—Ç–∞—Å–µ—Ç ‚Ññ2'):
    color = sns.color_palette(PALETTE_NUMERIC)
    num_cols = [col for col in features if discrete is None or col not in discrete]
    
    if num_cols:
        n_cols = 2
        n_rows = (len(num_cols) + n_cols - 1) // n_cols
    
        fig, axes = plt.subplots(
            n_rows, 
            n_cols, 
            figsize=(18, 4 * n_rows)
        )

        fig.suptitle(
            '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–µ',
            y=1,
            fontsize=16,
            weight='bold'
        )
        
        axes = axes.flatten()

        for col, ax in zip(num_cols, axes):            
            sns.histplot(
                df_1[col],
                bins=BINS, 
                color=color[2], 
                label=df1_label,
                stat='density',
                common_norm=False,
                kde=True,
                alpha=0.5,
                ax=ax
            )

            sns.histplot(
                df_2[col], 
                bins=BINS, 
                color=color[4], 
                label=df2_label,
                stat='density',
                common_norm=False,
                kde=True,
                alpha=0.5,
                ax=ax
            )

            ax.set_title(
                col.capitalize().replace('_', ' '),
                fontsize=12,
                weight='bold'
            )

            ax.set(
                xlabel=X_CAPTION_NUMERIC,
                ylabel=Y_CAPTION_NUMERIC
            )

            ax.legend()

        for ax in axes[len(num_cols):]:        
            ax.set_visible(False)

        plt.tight_layout()
        plt.show()
    
    if discrete:
        n_cols = 2
        n_rows = (len(discrete) + n_cols - 1) // n_cols
    
        fig, axes = plt.subplots(
            n_rows, 
            n_cols, 
            figsize=(18, 4 * n_rows)
        )

        fig.suptitle(
            '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: –¥–∏—Å–∫—Ä–µ—Ç–Ω—ã–µ',
            y=1,
            fontsize=16,
            weight='bold'
        )
        
        axes = axes.flatten()

        for col, ax in zip(discrete, axes):            
            sns.countplot(
                x=df_1[col], 
                color=color[2],
                label=df1_label,
                alpha=0.5,
                ax=ax
            )

            sns.countplot(
                x=df_2[col], 
                color=color[4],
                label=df2_label,
                alpha=0.5,
                ax=ax
            )

            ax.set_title(
                col.capitalize().replace('_', ' '),
                fontsize=12,
                weight='bold'
            )

            ax.set(
                xlabel=X_CAPTION_NUMERIC,
                ylabel=Y_CAPTION_NUMERIC
            )

        for ax in axes[len(discrete):]:        
            ax.set_visible(False)

        plt.tight_layout()
        plt.show()   
        


# In[43]:


def show_hist_kde_plot(df, x, hue=None, bins=BINS, hist=True, kde=True, alpha=0.6):     
    counts = df[hue].value_counts() if hue else []
    palette = sns.color_palette(PALETTE_NUMERIC, len(counts) if hue else 1)
    suptitle = x.capitalize().replace('_', ' ')
        
    fig, (ax_1, ax_2) = plt.subplots(
        nrows=2,
        ncols=1,
        figsize=(16, 8),
        sharex=True,
    )
    
    fig.suptitle(
        suptitle,
        y=1,
        size=16,
        weight='bold'
    )
        
    if hist:
        sns.histplot(
            data=df,
            x=x,
            bins=bins,
            stat='density',
            hue=hue,
            palette=palette,
            alpha=alpha,
            common_norm=False,
            ax=ax_1
        )
        
    if kde:
        sns.kdeplot(
            data=df,
            x=x,
            hue=hue,
            palette=palette,
            alpha=alpha,
            common_norm=False,
            fill=True,
            ax=ax_2
        )
        
    for ax in (ax_1, ax_2):
        ax.set(
            xlabel=X_CAPTION_NUMERIC,
            ylabel=Y_CAPTION_CAT
        )
    
    plt.tight_layout()
    plt.show()


# ### –ê–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ `test_features_cleaned`
# ___

# #### –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ 

# In[44]:


# –ê–Ω–∞–ª–∏–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
show_full_analysis_plots(test_features_cleaned, 'num')


# In[45]:


# –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
show_full_analysis_plots(test_features_cleaned, 'cat')


# #### –ö–æ—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑

# In[46]:


# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–±—â–µ–π –º–∞—Ç—Ä–∏—Ü—ã –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
# –û—Ç–±–æ—Ä –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã—Ö –≤–µ–ª–∏—á–∏–Ω –¥–ª—è –º–∞—Ç—Ä–∏—Ü—ã
test_features_interval_cols = (
    test_features_cleaned
    .drop(['employment_years', 'supervisor_evaluation'], axis=1)
    .select_dtypes(exclude=['category', object])
    .columns
)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã
test_features_corr_matrix = (
    test_features_cleaned
    .phik_matrix(interval_cols=test_features_interval_cols)
)

test_features_corr_mask = (
    np
    .triu(np.ones(test_features_corr_matrix.shape), k=1)
)

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã
show_corr_heatmap_plot(
    test_features_corr_matrix,
    test_features_corr_mask
)


# In[47]:


# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —É—Ä–æ–≤–Ω–µ–π –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
test_features_corr_lvls = get_corr_levels(
    test_features_corr_matrix,
    test_features_corr_mask
)

test_features_corr_lvls.head(5)


# #### –í—ã–≤–æ–¥—ã
# **–ê–Ω–∞–ª–∏–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
# > - –í –ø—Ä–∏–∑–Ω–∞–∫–µ **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã** –≤—ã–±—Ä–æ—Å–æ–≤ –∏ –∞–Ω–æ–º–∞–ª–∏–π –Ω–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è, –Ω–æ –º–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å –Ω–∞–∏–º–µ–Ω—å—à–µ–µ –∫–æ–ª-–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–∞–¥–æ–ª–≥–æ, —Ç.–µ. –±–æ–ª–µ–µ 3-—Ö –ª–µ—Ç
# > - –í –ø—Ä–∏–∑–Ω–∞–∫–µ **–ó–∞—Ä–ø–ª–∞—Ç–∞** –Ω–∞–±–ª—é–¥–∞—é—Ç—Å—è –∞–Ω–æ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –≤—ã–±—Ä–æ—Å—ã. –í–µ—Ä–æ—è—Ç–Ω–æ, —ç—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –Ω–æ—Ä–º–æ–π, —Ç.–∫. –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≥—Ä–µ–π–¥–∞ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–µ –∑–∞—Ä–ø–ª–∞—Ç—ã –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –¥—Ä—É–≥–∏–º–∏
# 
# **–ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
# > - –í –ø—Ä–∏–∑–Ω–∞–∫–µ **–û—Ç–¥–µ–ª** —è–≤–Ω–æ –ª–∏–¥–∏—Ä—É–µ—Ç –æ—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂ (763 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏–ª–∏ 38.2% –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ –ø–æ –æ—Ç–¥–µ–ª–∞–º), 
# > - –í –ø—Ä–∏–∑–Ω–∞–∫–µ **–£—Ä–æ–≤–µ–Ω—å –≥—Ä–µ–π–¥–∞** –º–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã —É—Ä–æ–≤–Ω—è Junior –∏ Middle —è–≤–ª—è—é—Ç—Å—è —Å–∞–º—ã–º–∏ –º–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã–º–∏ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–≤–Ω—ã–º–∏ (—Ä–∞–∑–Ω–∏—Ü–∞ –≤ 120 —á–µ–ª.), –ø—Ä–∏ —ç—Ç–æ–º –≥—Ä–µ–π–¥ Senior —Å–∞–º—ã–π –º–∞–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–π. –≠—Ç–æ –º–æ–∂–µ—Ç —è–≤–ª—è—Ç—å—Å—è –Ω–æ—Ä–º–æ–π, —Ç.–∫. —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ —É—Ä–æ–≤–Ω—è Senior –¥–æ–≤–æ–ª—å–Ω–æ —Ä–µ–¥–∫–æ –º–æ–∂–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –Ω–∞ —Ä—ã–Ω–∫–µ —Ç—Ä—É–¥–∞ –∏ —á–∞—Å—Ç–æ –∫–æ–º–ø–∞–Ω–∏—è–º –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Ö –±–æ–ª—å—à–æ–µ –∫–æ–ª-–≤–æ
# > - –í –ø—Ä–∏–∑–Ω–∞–∫–µ **–£—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç–∏** –º–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –≤ —Ü–µ–ª–æ–º —É –ø–æ–ª–æ–≤–∏–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (1043 —á–µ–ª.) –æ–Ω–∞ –°—Ä–µ–¥–Ω—è—è, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–π
# > - –í –ø—Ä–∏–∑–Ω–∞–∫–µ **–ù–∞–ª–∏—á–∏–µ –ø–æ–≤—ã—à–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥)** –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è —è–≤–Ω—ã–π –ø–µ—Ä–µ–≤–µ—Å –≤ –ø–æ–ª—å–∑—É –µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è (–≤—Å–µ–≥–æ 63 –∏–∑ 2000). –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –æ —Ç–æ–º, —á—Ç–æ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ–æ—Ö–æ—Ç–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –ø–æ–≤—ã—à–µ–Ω–∏–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, —á—Ç–æ –Ω–µ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ –º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å
# > - –í –ø—Ä–∏–∑–Ω–∞–∫–µ **–ù–∞–ª–∏—á–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥)** –Ω–∞–±–ª—é–¥—è–µ—Ç—Å—è —è–≤–Ω—ã–π –ø–µ—Ä–µ–≤–µ—Å –≤ –ø–æ–ª—å–∑—É –∏—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è (262 –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–æ—Ç–∏–≤ 2000)
# > - –í –ø—Ä–∏–∑–Ω–∞–∫–µ **–û—Ü–µ–Ω–∫–∞ —Ä–∞–±–æ—Ç—ã —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º** –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–∞–º—ã—Ö —á–∞—Å—Ç—ã—Ö –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å 4 (857 –æ—Ü–µ–Ω–æ–∫) –∏ 3 (575 –æ—Ü–µ–Ω–æ–∫)
# 
# **–ö–æ—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–∞—Ç—Ä–∏—Ü—ã:**
# 
# > –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–∞—Ç—Ä–∏—Ü—ã –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ:
# > - **–£—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç–∏** –æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ **–£—Ä–æ–≤–µ–Ω—å –∑–∞—Ä–ø–ª–∞—Ç—ã** - **`0.79`**
# > - **–£—Ä–æ–≤–µ–Ω—å –≥—Ä–µ–π–¥–∞** —Ç–∞–∫–∂–µ –æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ **–£—Ä–æ–≤–µ–Ω—å –∑–∞—Ä–ø–ª–∞—Ç—ã** - **`0.75`** –∏ –æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω–µ–µ (–Ω–æ –±–ª–∏–∑–∫–æ–µ –∫ –≤—ã—Å–æ–∫–æ–º—É) –≤–ª–∏—è–Ω–∏–µ –Ω–∞ **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã** - **`0.69`**

# ### –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
# ___

# #### –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑: `test_target_jsr_cleaned`

# In[48]:


# –ê–Ω–∞–ª–∏–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
show_full_analysis_plots(test_target_jsr_cleaned, 'num')


# #### –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:  `'jsr' + 'test_features'`

# In[49]:


# –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–≥–æ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º
# –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
jsr_data_merged = test_features_cleaned.merge(test_target_jsr_cleaned, on='id')

discrete_features = [
    'supervisor_evaluation',
    'employment_years', 
    'level', 
    'dept', 
    'workload',
    'last_year_promo', 
    'last_year_violations',
]

show_compared_histplots(
    train_jsr_cleaned,
    jsr_data_merged,
    jsr_data_merged.columns,
    discrete_features,
    df1_label='JSR: train',
    df2_label='JSR: test'
)


# #### –ö–æ—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑: `train_jsr_cleaned`

# In[50]:


# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–±—â–µ–π –º–∞—Ç—Ä–∏—Ü—ã –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
# –û—Ç–±–æ—Ä –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã—Ö –≤–µ–ª–∏—á–∏–Ω –¥–ª—è –º–∞—Ç—Ä–∏—Ü—ã
train_jsr_interval_cols = (
    train_jsr_cleaned
    .drop(['employment_years', 'supervisor_evaluation'], axis=1)
    .select_dtypes(exclude=['category', object])
    .columns
)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã
train_jsr_corr_matrix = (
    train_jsr_cleaned
    .phik_matrix(interval_cols=train_jsr_interval_cols)
)

train_jsr_corr_mask = (
    np
    .triu(np.ones(train_jsr_corr_matrix.shape),k=1)
)

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã
show_corr_heatmap_plot(
    train_jsr_corr_matrix,
    train_jsr_corr_mask
)


# In[51]:


# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —É—Ä–æ–≤–Ω–µ–π –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
train_jsr_corr_lvls = get_corr_levels(
    train_jsr_corr_matrix,
    train_jsr_corr_mask,
    target=TARGET_JSR
)

train_jsr_corr_lvls.head(5)


# #### –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–±—Ä–æ—Å–∞ –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö `train_jsr_cleaned`

# In[52]:


# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –∏ —Ä–∞–∑–±—Ä–æ—Å–∞
# –≤ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–∏ —Ü–µ–ª–µ–≤–æ–≥–æ –∫ –∑–∞—Ä–ø–ª–∞—Ç–µ (–º–µ—Å—è—Ü) –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã (–ª–µ—Ç)
# –∫ –æ—Ü–µ–Ω–∫–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã –∏ –Ω–∞—Ä—É—à–µ–Ω–∏—é –¢–î
for x in ['salary', 'employment_years']:
    show_scatter_kde_plot(
        train_jsr_cleaned,
        x=x,
        y=TARGET_JSR,
        hue='supervisor_evaluation'
    )
    
    show_scatter_kde_plot(
        train_jsr_cleaned,
        x=x,
        y=TARGET_JSR,
        hue='last_year_violations'
    )


# #### –í—ã–≤–æ–¥—ã
# 
# **–û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ `test_target_jsr_cleaned`:**
# > - –ù–∞ –≥—Ä–∞—Ñ–∏–∫–µ —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –∞–Ω–æ–º–∞–ª–∏–π –Ω–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è. –ì—Ä–∞—Ñ–∏–∫ –∏–º–µ–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ–º—è—â–µ–µ—Å—è –∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º—É –∏ –µ–≥–æ –º–µ–¥–∏–∞–Ω–∞ –Ω–∞—Ö—Ö–æ–¥—è—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ **`0.58`**
# 
# **–ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:  `'jsr' + 'test_features'`:**
# > - –ö–∞–∫–∏—Ö-–ª–∏–±–æ –∞–Ω–æ–º–∞–ª–∏–π –∏–ª–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
# 
# **–ö–æ—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ `train_jsr_cleaned`:**
# > –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–∞—Ç—Ä–∏—Ü—ã –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –ø–æ —Ü–µ–ª–µ–≤–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É **–£—Ä–æ–≤–µ–Ω—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤** –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ –Ω–∞–∏–±–æ–ª—å—à–µ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –Ω–µ–≥–æ –æ–∫–∞–∑—ã–≤–∞—é—Ç:
# > - **–æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã**, —á—Ç–æ –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å –æ –Ω–∞–ª–∏—á–∏–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π (–∏, –≤–µ—Ä–æ—è—Ç–Ω–æ, –Ω–µ–æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ–π —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –æ—Ü–µ–Ω—â–∏–∫–∞) —Å–æ—Å—Ç–∞–≤–ª—è—é—â–µ–π, –∫–æ—Ç–æ—Ä–∞—è –≤–ª–∏—è–µ—Ç –Ω–∞ –¥–∞–ª—å–Ω–µ–π—à—É—é –º–æ—Ç–∏–≤–∞—Ü–∏—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
# > - **–Ω–∞—Ä—É—à–µ–Ω–∏–µ –¢–î (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥)**, —á—Ç–æ, –Ω–∞–ø—Ä—è–º—É—é —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –ø—Ä–æ–±–ª–µ–º —É —Å–∞–º–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏ –≤–ª–∏—è—é—Ç –Ω–∞ –µ–≥–æ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∏ —Ç—Ä–µ–±—É–µ—Ç –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏—Ö –æ—Ü–µ–Ω–æ–∫
# 
# **–ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–±—Ä–æ—Å–∞ –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö `train_jsr_cleaned`**
# > - –í –æ–±—â–µ–º –ø–æ –≥—Ä–∞—Ñ–∏–∫–∞–º **–û—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã** –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥, —á—Ç–æ –Ω–∏–∑–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∏ –∫ –Ω–∏–∑–∫–æ–π —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–æ–π. –ò–ª–∏ –∂–µ —Å–∏—Ç—É–∞—Ü–∏—è –≤ –¥—Ä—É–≥–æ–º - –Ω–∏–∑–∫–∞—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ—Å–ª–µ–¥—É—é—â—É—é –Ω–∏–∑–∫—É—é –æ—Ü–µ–Ω–∫—É –µ–≥–æ —Ä–∞–±–æ—Ç—ã. –û–±–Ω–∞—Ä—É–∂–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø–æ–∫–∞ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω—ã–º, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–∞–ª—å–Ω–µ–π—à–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
# > - –ü–æ –≥—Ä–∞—Ñ–∏–∫–∞–º **–ù–∞—Ä—É—à–µ–Ω–∏—è –¢–î (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥)**, –º–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—É—é —Å–≤—è–∑—å –º–µ–∂–¥—É —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏ –µ–≥–æ –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è–º–∏. –ß–µ–º –º–µ–Ω–µ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —Ä–∞–±–æ—Ç–æ–π, —Ç–µ–º –±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å –µ–≥–æ —Å—Ç–æ—Ä–æ–Ω—ã. –û–±—Ä–∞—Ç–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –∫–∞–∂–µ—Ç—Å—è –º–µ–Ω–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π, –Ω–æ —Ç–æ–∂–µ –≤–µ—Ä–æ—è—Ç–Ω–∞, –¥–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–∞–ª—å–Ω–µ–π—à–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

# ### –ê–Ω–∞–ª–∏–∑ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
# ___

# #### –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ `test_target_quit_cleaned`

# In[53]:


show_full_analysis_plots(test_target_quit_cleaned, 'cat')


# #### –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:  `'quit' + 'test_features'`

# In[54]:


# –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–≥–æ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º
# –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
quit_data_merged = test_features_cleaned.merge(test_target_quit_cleaned, on='id')

discrete_features = [
    'supervisor_evaluation',
    'employment_years', 
    'level', 
    'dept', 
    'workload',
    'last_year_promo', 
    'last_year_violations',
    'quit'
]

show_compared_histplots(
    train_quit_cleaned,
    quit_data_merged,
    quit_data_merged.columns,
    discrete_features,
    df1_label='Quit: train',
    df2_label='Quit: test'
)


# #### –ö–æ—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ `train_quit_cleaned`

# In[55]:


# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–±—â–µ–π –º–∞—Ç—Ä–∏—Ü—ã –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
# –û—Ç–±–æ—Ä –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã—Ö –≤–µ–ª–∏—á–∏–Ω –¥–ª—è –º–∞—Ç—Ä–∏—Ü—ã
train_quit_interval_cols = (
    train_quit_cleaned
    .drop(['employment_years', 'supervisor_evaluation'], axis=1)
    .select_dtypes(exclude=['category', object])
    .columns
)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã
train_quit_corr_matrix = (
    train_quit_cleaned
    .phik_matrix(interval_cols=train_quit_interval_cols)
)

train_quit_corr_mask = (
    np
    .triu(np.ones(train_quit_corr_matrix.shape),k=1)
)

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã
show_corr_heatmap_plot(
    train_quit_corr_matrix,
    train_quit_corr_mask
)


# In[56]:


# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —É—Ä–æ–≤–Ω–µ–π –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
train_quit_corr_lvls = get_corr_levels(
    train_quit_corr_matrix,
    train_quit_corr_mask,
    target=TARGET_QUIT
)

train_quit_corr_lvls.head(5)


# #### –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–±—Ä–æ—Å–∞ –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö `train_quit_cleaned`

# In[57]:


show_scatter_kde_plot(
    train_quit_cleaned,
    y='salary',
    x='employment_years',
    hue=TARGET_QUIT
)


# #### –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ä–µ—Ç–∞ ‚Ññ1: `–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å - –û—Ç–¥–µ–ª <-> –£–≤–æ–ª–∏–ª—Å—è/–û—Å—Ç–∞–ª—Å—è`

# In[58]:


df_quit_yes = quit_data_merged.query('quit == "yes"')
df_quit_no = quit_data_merged.query('~(quit == "yes")')

for col in df_quit_yes.columns.drop(['salary', 'quit']):
    show_bar_pie_plot(df_quit_yes, col)


# In[59]:


# –†–∞—Å—á–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã —É–≤–æ–ª–∏–≤—à–∏—Ö—Å—è –∏ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
salary_quit_yes = np.mean(df_quit_yes.salary)
salary_quit_no = np.mean(df_quit_no.salary)

display(Markdown(f'''### –†–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–∏—Ö –∑–∞—Ä–ø–ª–∞—Ç
--- 
- **–°—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞ —É—à–µ–¥—à–∏—Ö:** {salary_quit_yes:.2f} —Ä—É–±.
- **–°—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è:** {salary_quit_no:.2f} —Ä—É–±.
- **–†–∞–∑–Ω–∏—Ü–∞:** {(salary_quit_no - salary_quit_yes):.2f} —Ä—É–±.
'''))


# #### –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ä–µ—Ç–∞ ‚Ññ2: `–£—Ä–æ–≤–µ–Ω—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ <-> –£–≤–æ–ª–∏–ª—Å—è/–û—Å—Ç–∞–ª—Å—è`
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–∏–ø–æ—Ç–µ–∑—ã: –£–≤–æ–ª–∏–≤—à–∏–µ—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –º–µ–Ω–µ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã, —á–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è
# $$H_0: \mu_{yes} ‚â• \mu_{no}$$
# $$H_1: \mu_{yes}< \mu_{no}$$

# In[60]:


# –ü—Ä–æ–≤–µ—Ä–≥–∞ –≥–∏–ø–æ—Ç–µ–∑—ã –Ω–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å
ttest_jsr_data = quit_data_merged.merge(jsr_data_merged, on='id')

quit_yes = ttest_jsr_data.query('quit == "yes"')[TARGET_JSR]
quit_no = ttest_jsr_data.query('~(quit == "yes")')[TARGET_JSR]

ttest_results = ttest_ind(
    quit_yes,
    quit_no,
    equal_var=False,
    alternative='less'
)

alpha = 0.05

display(Markdown(f''' ### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ ttest:
___
- **–°—Ä–µ–¥–Ω–µ–µ JSR Quit Yes**: `{np.mean(quit_yes):.2f}` ({len(quit_yes)} —á–µ–ª.)
- **–°—Ä–µ–¥–Ω–µ–µ JSR Quit No**: `{np.mean(quit_no):.2f}` ({len(quit_no)} —á–µ–ª.)
- **p-value**: `{ttest_results.pvalue:.3f}`
'''))

if ttest_results.pvalue < alpha:
    display(Markdown(f'**–û—Ç–≤–µ—Ä–≥–∞–µ–º H0:** —É–≤–æ–ª–∏–≤—à–∏–µ—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ –º–µ–Ω–µ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã'))
else:
    display(Markdown(f'**–ù–µ –æ—Ç–≤–µ—Ä–≥–∞–µ–º H0:** —É–≤–æ–ª–∏–≤—à–∏–µ—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ –Ω–µ –º–µ–Ω–µ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã'))


# In[61]:


# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
show_hist_kde_plot(
    ttest_jsr_data,
    x=TARGET_JSR,
    hue=TARGET_QUIT
)


# #### –í—ã–≤–æ–¥—ã
# 
# **–û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ `test_target_quit_cleaned`:**
# > - –í –ø—Ä–∏–∑–Ω–∞–∫–µ **–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (—Ü–µ–ª–µ–≤–æ–π)** –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è –ø–µ—Ä–µ–≤–µ—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É –∑–Ω–∞—á–µ–Ω–∏—è **–ù–µ—Ç** (1436 –∏–ª–∏ 71.8% –ø—Ä–æ—Ç–∏–≤ 564 –∏–ª–∏ 28.2%)
# 
# **–ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:  `'quit' + 'test_features'`:**
# > - –ö–∞–∫–∏—Ö-–ª–∏–±–æ –∞–Ω–æ–º–∞–ª–∏–π –∏–ª–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
# 
# **–ö–æ—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ `train_quit_cleaned`:**
# 
# > –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏ –º–∞—Ç—Ä–∏—Ü—ã –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –ø–æ —Ü–µ–ª–µ–≤–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É –£—Ö–æ–¥ –∏–∑ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ –Ω–∞–∏–±–æ–ª—å—à–µ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –Ω–µ–≥–æ –æ–∫–∞–∑—ã–≤–∞—é—Ç:
# > - **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã** –≤ –∫–æ–º–ø–∞–Ω–∏–∏, —á—Ç–æ –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å –æ –Ω–µ–∫–æ—Ç–æ—Ä–æ–º —Å—Ä–æ–∫–µ —Ä–∞–±–æ—Ç—ã —Å–ø—É—Å—Ç—è –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ–±—ã—á–Ω–æ —É—Ö–æ–¥—è—Ç –∏–∑ –∫–æ–º–ø–∞–Ω–∏–∏
# > - **–ó–∞—Ä–ø–ª–∞—Ç–∞ (–º–µ—Å—è—Ü)**, –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—É—á–∞–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, —á—Ç–æ –∏–º–µ–µ—Ç –º–µ—Å—Ç–æ –±—ã—Ç—å, —Ç.–∫. –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—ã—à–µ–Ω–∏—è –≤ –¥–æ—Ö–æ–¥–∞—Ö —Ç–∞–∫ –∏–ª–∏ –∏–Ω–∞—á–µ –æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –ª—é–±–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
# 
# **–ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–±—Ä–æ—Å–∞ –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö `train_quit_cleaned`**
# > - –°–æ–≥–ª–∞—Å–Ω–æ —Å–∫–∞—Ç—Ç–µ—Ä –∏ –ö–î–ï –≥—Ä–∞—Ñ–∏–∫–∞–º –º–æ–∂–Ω–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–µ–º—è—Ç—Å—è –∫ –ª–∏–Ω–µ–π–Ω–æ–º—É —Ç–∏–ø—É. –ü—Ä–∏ —ç—Ç–æ–º **–Ω–∞–∏–±–æ–ª—å—à–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è–º, –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –∑–∞—Ä–ø–ª–∞—Ç–∞–º–∏ `‚âà50.000 —Ç—ã—Å.` –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç—ã `‚âà3 –ª–µ—Ç`**
# 
# **–ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ä–µ—Ç–∞ —É–≤–æ–ª–∏–≤—à–µ–≥–æ—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ‚Ññ1: –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**
# 
# > –°–æ–≥–ª–∞—Å–Ω–æ –¥–∞–Ω–Ω–æ–º—É –∞–Ω–∞–ª–∏–∑—É –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥, —á—Ç–æ **—á–∞—â–µ –≤—Å–µ–≥–æ —É–≤–æ–ª—å–Ω—è—é—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏**:
# > - –∏–∑ –æ—Ç–¥–µ–ª–∞ **–ø—Ä–æ–¥–∞–∂**
# > - —Å –≥—Ä–µ–π–¥–æ–º **junior**
# > - —Å **–≤—ã—Å–æ–∫–æ–π –∏ —Å—Ä–µ–¥–Ω–µ–π** –Ω–∞–≥—Ä—É–∑–∫–æ–π
# > - —Å **–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç—ã –¥–æ 2-—Ö –ª–µ—Ç**
# > - —É –∫–æ—Ç–æ—Ä—ã—Ö **–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ –ø–æ–≤—ã—à–µ–Ω–∏–µ** –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥
# > - –≤ —Ü–µ–ª–æ–º **–Ω–µ —Å–æ–≤–µ—Ä—à–∞–≤–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π –¢–î**
# > - –∏ **—Å –æ—Ü–µ–Ω–∫–æ–π –≤ 3-4 –±–∞–ª–ª–∞** –æ—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è
# > 
# > –¢–∞–∫–∂–µ —Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞—Ä–ø–ª–∞—Ç–∞–º **`—É–≤–æ–ª–∏–≤—à–∏–µ—Å—è –ø–æ–ª—É—á–∞–ª–∏ –Ω–∞ 12690 —Ä—É–±. –º–µ–Ω—å—à–µ (–∏–ª–∏ 24955 —Ä—É–±.), —á–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è (37645 —Ä—É–±.)`**
# 
# **–ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ä–µ—Ç–∞ —É–≤–æ–ª–∏–≤—à–µ–≥–æ—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ‚Ññ2: –£—Ä–æ–≤–µ–Ω—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏:**
# 
# > –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π –≥–∏–ø–æ—Ç–µ–∑—ã "–£–≤–æ–ª–∏–≤—à–∏–µ—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –º–µ–Ω–µ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã, —á–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è" –ø–æ–∫–∞–∑–∞–ª–∞, —á—Ç–æ **—É–≤–æ–ª–∏–≤—à–∏–µ—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ –º–µ–Ω–µ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã, H0 –æ—Ç–≤–µ—Ä–≥–∞–µ—Ç—Å—è**
# > 
# > –°–æ–≥–ª–∞—Å–Ω–æ –∞–Ω–∞–ª–∏–∑—É –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥, —á—Ç–æ:
# > - —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —á–∞—â–µ —É–≤–æ–ª—å–Ω—è—é—Ç—Å—è, –µ—Å–ª—É –æ–Ω–∏ –º–µ–Ω–µ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã —É—Å–ª–æ–≤–∏—è–º–∏
# > - —Ä–∞–≤–Ω–æ–µ –∏ –æ–±—Ä–∞—Ç–Ω–æ–µ: —á–∞—â–µ –æ—Å—Ç–∞—é—Ç—Å—è –±–æ–ª–µ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
# > - –ø—Ä–∏ —ç—Ç–æ–º –Ω–∞ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–µ –≤–∏–¥–Ω–æ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ä–∞–≤–Ω—ã—Ö —Å—Ä–µ–¥–Ω–∏—Ö –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö –¥–ª—è –æ–±–µ–∏—Ö –≥—Ä—É–ø–ø

# ## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –æ–±—É—á–µ–Ω–∏–µ ML-–º–æ–¥–µ–ª–µ–π
# ___

# ### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è ML-–º–æ–¥–µ–ª–µ–π
# ___

# In[62]:


def smape_score(y_true, y_pred):
    '''
    –í—ã—á–∏—Å–ª—è–µ—Ç —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—É—é —Å—Ä–µ–¥–Ω—é—é –∞–±—Å–æ–ª—é—Ç–Ω—É—é –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—É—é –æ—à–∏–±–∫—É (SMAPE) –º–µ–∂–¥—É –∏—Å—Ç–∏–Ω–Ω—ã–º–∏ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

    SMAPE (Symmetric Mean Absolute Percentage Error) ‚Äî —ç—Ç–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π,
    –∏–∑–º–µ—Ä—è—é—â–∏–π —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π –æ—à–∏–±–∫–∏ –º–µ–∂–¥—É –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –∏ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏,
    –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö. –§–æ—Ä–º—É–ª–∞ SMAPE —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞ –∏ —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –Ω—É–ª–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º

    –§–æ—Ä–º—É–ª–∞: SMAPE = mean( |y_pred - y_true| / ((|y_true| + |y_pred|) / 2) ) * 100
    '''
    
    epsilon = 1e-12  # –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
    numerator = np.abs(y_pred - y_true)
    denominator = (np.abs(y_true) + np.abs(y_pred) + epsilon) / 2
    smape_result = np.mean(numerator / denominator) * 100
    
    return smape_result

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ü–µ–Ω—â–∏–∫–∞ SMAPE
smape_scorer = make_scorer(smape_score, greater_is_better=False)


# In[63]:


def get_samples_shape_info(X_train, X_test, y_train, y_test):
    result = pd.DataFrame(
        data={
            'X_shape': [X_train.shape, X_test.shape],
            'y_shape': [y_train.shape, y_test.shape]
        },
        index=['Train', 'Test']
    )
    
    display(Markdown(f'## –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–æ–∫ \n___\n'))
    display(result)


# In[64]:


def build_pipeline(task,
                   ohe_columns,
                   ord_columns,
                   num_columns,
                   ord_categories,
                   model=None,
                   num_scaler=None,
                   poly_degree=None):
    
    if model is None:
        if task == 'reg':
            model = DecisionTreeRegressor(random_state=RANDOM_STATE)
        elif task == 'clf':
            model = DecisionTreeClassifier(random_state=RANDOM_STATE)
        
    ohe_pipe = Pipeline([
        ('imputer_ohe', SimpleImputer(missing_values=np.nan, strategy='most_frequent')),
        ('ohe', OneHotEncoder(drop='first', handle_unknown='ignore', sparse_output=False))
    ])
    
    ord_pipe = Pipeline([
        ('imputer_before_ord', SimpleImputer(missing_values=np.nan, strategy='most_frequent')),
        ('ord', OrdinalEncoder(categories=ord_categories, handle_unknown='use_encoded_value', unknown_value=-1)),
        ('imputer_after_ord', SimpleImputer(missing_values=np.nan, strategy='most_frequent'))
    ])
    
    if poly_degree is None or poly_degree == 1:
        num_pipe = Pipeline([
            ('scaler', num_scaler)
        ])
    else:
        num_pipe = Pipeline([
            ('scaler', num_scaler),
            ('poly', PolynomialFeatures(degree=poly_degree))
        ])
        
    preprocessor = ColumnTransformer([
        ('ohe', ohe_pipe, ohe_columns),
        ('ord', ord_pipe, ord_columns),
        ('num', num_pipe, num_columns)
    ], remainder='passthrough')
    
    pipeline = Pipeline([
        ('preprocessor', preprocessor),
        ('model', model)
    ])
    
    return pipeline


# In[65]:


def construct_param_grid_sklearn(task, preprocessor_num=None):
    if preprocessor_num is None:
        preprocessor_num = [StandardScaler(), MinMaxScaler(), RobustScaler(), 'passthrough']

    if task == 'reg':
        return [
            {
                'model': [DecisionTreeRegressor(random_state=RANDOM_STATE)],
                'model__max_depth': np.arange(2, 5),
                'model__max_features': np.arange(2, 5),
                'preprocessor__num__scaler': preprocessor_num
            },
            {
                'model': [KNeighborsRegressor()],
                'model__n_neighbors': np.arange(2, 8),
                'preprocessor__num__scaler': preprocessor_num
            },
            {
                'model': [SVR()],
                'model__C': [0.1, 1, 10],
                'preprocessor__num__scaler': preprocessor_num
            },
            {
                'model': [LinearRegression()],
                'model__fit_intercept': [True, False],
                'preprocessor__num__scaler': preprocessor_num
            }
        ]
    elif task == 'clf':
        return [
            {
                'model': [LogisticRegression(class_weight='balanced', solver='liblinear', penalty='l1', random_state=RANDOM_STATE)],
                'model__C': np.arange(2, 11),
                'preprocessor__num__scaler': preprocessor_num
            },
            {
                'model': [DecisionTreeClassifier(class_weight='balanced', random_state=RANDOM_STATE)],
                'model__max_depth': np.arange(1, 6),
                'model__max_features': np.arange(1, 6),
                'preprocessor__num__scaler': preprocessor_num
            },
            {
                'model': [KNeighborsClassifier(n_neighbors=7)],
                'model__n_neighbors': np.arange(2, 11),
                'preprocessor__num__scaler': preprocessor_num
            },
            {
                'model': [SVC(class_weight='balanced', probability=True, random_state=RANDOM_STATE)],
                'model__C': [0.001, 0.01, 0.1, 1, 10, 100],
                'model__kernel': ['linear', 'rbf'],
                'model__gamma': ['scale', 'auto'],
                'preprocessor__num__scaler': preprocessor_num
            }
        ]
    else:
        return display(Markdown(f'–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ task: "{task}". –î–æ—Å—Ç—É–ø–Ω—ã "`reg`" –∏ "`clf`".'))


# In[66]:


def construct_param_grid_optuna(task, preprocessor_num=None):
    if preprocessor_num is None:
        preprocessor_num = [StandardScaler(), MinMaxScaler(), RobustScaler(), 'passthrough']
        
    if task == 'reg':
        return {
            'knn': {
                'model': CategoricalDistribution([KNeighborsRegressor()]),
                'model__n_neighbors': IntDistribution(2, 7),
                'preprocessor__num__scaler': CategoricalDistribution(preprocessor_num)
            },
            'decision_tree': {
                'model': CategoricalDistribution([DecisionTreeRegressor(random_state=RANDOM_STATE)]),
                'model__max_depth': IntDistribution(2, 7),
                'model__min_samples_split': IntDistribution(2, 5),
                'model__min_samples_leaf': IntDistribution(2, 5),
                'preprocessor__num__scaler': CategoricalDistribution(preprocessor_num)
            },
            'linreg': {
                'model': CategoricalDistribution([LinearRegression()]),
                'model__fit_intercept': CategoricalDistribution([True, False]),
                'preprocessor__num__scaler': CategoricalDistribution(preprocessor_num)
            },
            'svr': {
                'model': CategoricalDistribution([SVR()]),
                'model__kernel': CategoricalDistribution(['rbf', 'sigmoid', 'poly']),
                'model__C': FloatDistribution(0.01, 10, log=True),
                'preprocessor__num__scaler': CategoricalDistribution(preprocessor_num)
            }
        }
    elif task == 'clf':
        return {
            'knn': {
                'model': CategoricalDistribution([KNeighborsClassifier()]),
                'model__n_neighbors': IntDistribution(2, 7),
                'preprocessor__num__scaler': CategoricalDistribution(preprocessor_num)
            },
            'decision_tree': {
                'model': CategoricalDistribution([DecisionTreeClassifier(class_weight='balanced', random_state=RANDOM_STATE)]),
                'model__max_depth': IntDistribution(2, 7),
                'model__min_samples_split': IntDistribution(2, 5),
                'model__min_samples_leaf': IntDistribution(2, 5),
                'preprocessor__num__scaler': CategoricalDistribution(preprocessor_num)
            },
            'logreg': {
                'model': CategoricalDistribution([LogisticRegression(class_weight='balanced', random_state=RANDOM_STATE)]),
                'model__C': FloatDistribution(0.01, 10, log=True),
                'preprocessor__num__scaler': CategoricalDistribution(preprocessor_num)
            },
            'svc': {
                'model': CategoricalDistribution([SVC(class_weight='balanced', probability=True, random_state=RANDOM_STATE)]),
                'model__kernel': CategoricalDistribution(['rbf', 'sigmoid', 'poly']),
                'model__C': FloatDistribution(0.01, 10, log=True),
                'preprocessor__num__scaler': CategoricalDistribution(preprocessor_num)
            }
        }
    else:
        return display(Markdown(f'–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ task: "{task}". –î–æ—Å—Ç—É–ø–Ω—ã "`reg`" –∏ "`clf`".'))


# In[67]:


def get_searcher(final_pipeline,
                 param_grid,
                 search_method,
                 scoring=None,
                 cv=None):
    
    if search_method == 'randomized':
        return RandomizedSearchCV(
            final_pipeline,
            param_grid,
            scoring=scoring,
            n_iter=20,
            n_jobs=1,
            verbose=0,
            cv=cv,
            random_state=RANDOM_STATE,
        )
        
    if search_method == 'optuna':
        return OptunaSearchCV(
            final_pipeline,
            param_grid,
            cv=cv,
            scoring=scoring,
            n_trials=40,
            n_jobs=1,
            verbose=1,
            error_score='raise',
            random_state=RANDOM_STATE
        )


# In[68]:


def show_best_model_info(best_estimator: Pipeline, metrics_dict: dict, section_name=None):
    best_model_name = type(best_estimator.named_steps.model).__name__
    
    display(Markdown(f'# üîé –û–±–∑–æ—Ä –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏: `{best_model_name}`'))

    def show_section(title):
        display(Markdown(f'## {title}\n___\n'))
        
    def show_best_model():            
        show_section('üîù –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å')
        display(best_estimator.named_steps['model'])
    
    def show_best_model_preprocessor():
        show_section('‚öôÔ∏è –ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏')
        display(best_estimator.named_steps['preprocessor'])
    
    def show_metrics():        
        show_section('üìà –ú–µ—Ç—Ä–∏–∫–∏ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏')
        
        lines = []
        
        for name, val in metrics_dict.items():
            lines.append(f'**{name}:**\n```python\n{val:.4f}\n```')
            
        display(Markdown('\n'.join(lines)))
        
    sections = {
        'best_model': show_best_model,
        'best_model_preprocessor': show_best_model_preprocessor,
        'metrics': show_metrics,
    }
        
    if section_name is None:
        for func in sections.values():
            func()
    else:
        func = sections.get(section_name)
        
        if func:
            func()
        else:
            display(Markdown(f'''‚ö†Ô∏è –°–µ–∫—Ü–∏—è —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º **{section_name}** –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
            \n–î–æ—Å—Ç—É–ø–Ω—ã–µ: **{list(sections.keys())}**'''))


# In[69]:


def show_feature_importance_bar(df, threshold=0.05, top_n=10):
    df['norm_value'] = df.value / df.value.max()
    df = df.sort_values('value', ascending=False).head(top_n)
        
    fig, ax_1 = plt.subplots(
        figsize=(16, 8),
    )
    
    sns.barplot(
        x='value',
        y='name',
        hue='name',
        legend=False,
        data=df,
        palette=PALETTE_NUMERIC,
        ax=ax_1   
    )
    
    ax_1.set(
        xlabel='–í–∞–∂–Ω–æ—Å—Ç—å',
        ylabel='–ü—Ä–∏–∑–Ω–∞–∫',
    )
    
    for bar in ax_1.containers:
        ax_1.bar_label(bar, padding=3)
    
    fig.suptitle(
        f'–ü–µ—Ä–º—É—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –≤–∞–∂–Ω–æ—Å—Ç—å: TOP-{top_n} –ø—Ä–∏–∑–Ω–∞–∫–æ–≤',
        y=1,
        size=18,
        weight='black'
    )
    
    plt.axvline(
        threshold,
        color='grey',
        linestyle='dotted',
        animated=True,
        alpha=0.6
    )
    
    plt.tight_layout()
    plt.show()
    
    display(df)


# In[70]:


def show_shap(shap_values):
    plt.figure(figsize=(16, 8))
    shap.plots.bar(shap_values, show=False)
    plt.title('SHAP Bar', fontsize=16, weight='black')
    plt.show()
    
    plt.figure(figsize=(16, 8))
    shap.plots.beeswarm(shap_values, show=False)
    plt.title('SHAP Beeswarm', fontsize=16, weight='black')
    plt.show()
    
    plt.figure(figsize=(16, 8))
    shap.plots.waterfall(shap_values[30], show=False)
    plt.title('SHAP Waterfall', fontsize=16, weight='black')
    plt.show()


# ### –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
# ___

# #### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

# In[71]:


# –§–æ—Ä–º–∏—Ä—É–µ–º –≤—ã–±–æ—Ä–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
test_data_jsr, train_data_jsr = (
    test_features_cleaned.merge(test_target_jsr_cleaned, on='id'),
    train_jsr_cleaned
)


# In[72]:


# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–æ–∫
X_train_jsr, y_train_jsr, X_test_jsr, y_test_jsr = (
    train_data_jsr.drop('job_satisfaction_rate', axis=1),
    train_data_jsr.job_satisfaction_rate,
    test_data_jsr.drop('job_satisfaction_rate', axis=1),
    test_data_jsr.job_satisfaction_rate
)

get_samples_shape_info(
    X_train_jsr, 
    X_test_jsr, 
    y_train_jsr, 
    y_test_jsr
)


# In[73]:


# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏
ohe_columns = ['last_year_violations', 'last_year_promo', 'dept']
ord_columns = ['level', 'workload']
num_columns = ['employment_years', 'salary', 'supervisor_evaluation']
ord_categories = [
    list(X_train_jsr.level.unique()),
    list(X_train_jsr.workload.unique()),
]

pipeline_params_jsr = {
    'task': 'reg',
    'ohe_columns': ohe_columns,
    'ord_columns': ord_columns,
    'num_columns': num_columns,
    'ord_categories': ord_categories,
}

final_pipeline_jsr = build_pipeline(**pipeline_params_jsr)


# #### –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

# In[74]:


# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Dummy –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ–ª–µ–π –Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å
dummy_jsr = DummyRegressor(strategy='mean')
dummy_jsr.fit(X_train_jsr, y_train_jsr)

cv = KFold(n_splits=5, shuffle=True, random_state=RANDOM_STATE)


# In[75]:


# –ü–æ–∏—Å–∫ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ RandomizedSearch
randomized_param_grid_jsr = construct_param_grid_sklearn('reg')

rs_results_list = []
rs_best_pipeline_jsr = None
rs_best_pipeline_jsr_name = None
rs_best_pipeline_cv_score_jsr = float('-inf')

for param_dist in tqdm(randomized_param_grid_jsr, desc='RSCV Progress'):    
    rs_searcher = get_searcher(
        final_pipeline_jsr,
        param_dist,
        search_method='randomized',
        scoring=smape_scorer,
        cv=cv
    )
    
    with tqdm(total=1, desc=f'{param_dist["model"][0].__class__.__name__}') as pbar:
        rs_searcher.fit(X_train_jsr, y_train_jsr)
        
        pbar.update(1)
        pbar.set_postfix({'Best CV': f'{rs_searcher.best_score_:.4f}'})
            
    cv_score = rs_searcher.best_score_
    
    rs_results_list.append({
        'Best Model': rs_searcher.best_estimator_.named_steps.model,
        'Best CV': f'{cv_score:.4f}',
        'Train Time (sec.)': f'{rs_searcher.refit_time_:.2f}',
        'Pred Time (sec.)': f'{rs_searcher.cv_results_["mean_score_time"][rs_searcher.best_index_]:.2f}',
        'Method': 'RSVC'
    })
    
    if cv_score > rs_best_pipeline_cv_score_jsr:
        rs_best_pipeline_jsr = rs_searcher.best_estimator_
        rs_best_pipeline_cv_score_jsr = cv_score


# In[76]:


# –ü–æ–∏—Å–∫ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ Optuna Search
os_results_list = []
optuna_best_pipeline_jsr = None
optuna_best_pipeline_jsr_name = None
optuna_best_pipeline_cv_score_jsr = float('-inf')

optuna_param_grid_jsr = construct_param_grid_optuna('reg')

for model_key, dist in tqdm(optuna_param_grid_jsr.items(), 'OSCV Progress'):            
    optuna_searcher = get_searcher(
        final_pipeline_jsr,
        dist,
        search_method='optuna',
        scoring=smape_scorer,
        cv=cv
    )
    
    with tqdm(total=1, desc=f'{dist["model"].choices[0].__class__.__name__}') as pbar:
        optuna_searcher.fit(X_train_jsr, y_train_jsr)
        
        pbar.update(1)
        pbar.set_postfix({'Best CV ': f'{optuna_searcher.best_score_:.4f}'})
    
    cv_score = optuna_searcher.best_score_
    os_best_model_name = optuna_searcher.best_estimator_.named_steps.model.__class__.__name__
    
    os_results_list.append({
        'Best Model': f'{optuna_searcher.best_estimator_.named_steps.model}',
        'Best CV': f'{cv_score:.4f}',
        'Train Time (sec.)': f'{optuna_searcher.refit_time_:.2f}',
        'Pred Time (sec.)': f'{optuna_searcher.cv_results_["mean_score_time"][optuna_searcher.best_index_]:.2f}',
        'Method': 'OSCV'
    })
    
    if cv_score > optuna_best_pipeline_cv_score_jsr:
        optuna_best_pipeline_jsr = optuna_searcher.best_estimator_
        optuna_best_pipeline_cv_score_jsr = cv_score


# In[77]:


# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
jsr_full_results_list = pd.concat([
    pd.DataFrame(rs_results_list),
    pd.DataFrame(os_results_list)
]).sort_values('Best CV', ).reset_index(drop=True)

jsr_full_results_list.style.background_gradient(cmap=PALETTE_NUMERIC, subset=['Best CV'])


# In[78]:


# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ–ª–µ–π –Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å Dummy
y_test_dummy_jsr_pred = dummy_jsr.predict(X_test_jsr)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
y_test_jsr_pred = optuna_best_pipeline_jsr.predict(X_test_jsr)

# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞—Å—á–µ—Ç—ã –º–µ—Ç—Ä–∏–∫
main_metrics = {
    'CV': np.abs(optuna_best_pipeline_cv_score_jsr),
    'SMAPE': smape_score(y_test_jsr, y_test_jsr_pred)
}

dummy_metrics = {
    'CV': '-',
    'SMAPE': smape_score(y_test_jsr, y_test_dummy_jsr_pred)
}

best_model_metrics = pd.DataFrame(
    data=[main_metrics, dummy_metrics],
    index=['Best Model', 'Dummy Baseline']
)

# –í—ã–≤–æ–¥ –º–µ—Ç—Ä–∏–∫
display(Markdown(f'### –ú–µ—Ç—Ä–∏–∫–∏ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ \n___'))
display(optuna_best_pipeline_jsr.named_steps.model)
display(pd.DataFrame(best_model_metrics).T)


# #### –ê–Ω–∞–ª–∏–∑ –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

# In[79]:


# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–º—É—Ç–∞—Ü–∏–æ–Ω–Ω–æ–π –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
best_estimator_jsr = optuna_searcher.best_estimator_.named_steps
best_model_jsr = best_estimator_jsr.model
best_model_preprocessor_jsr = best_estimator_jsr.preprocessor
best_model_feature_names_jsr = best_model_preprocessor_jsr.get_feature_names_out()
X_test_jsr_preprocessor = best_model_preprocessor_jsr.transform(X_test_jsr)

permutation_result_jsr = permutation_importance(
    best_model_jsr, 
    X_test_jsr_preprocessor,
    y_test_jsr,
    scoring=smape_scorer,
    n_repeats=10
)


# In[80]:


# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
feature_importance_jsr = pd.DataFrame({
    'name': best_model_feature_names_jsr,
    'value': permutation_result_jsr.importances_mean,
    })

show_feature_importance_bar(feature_importance_jsr)


# In[81]:


# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ SHAP-–∑–Ω–∞—á–µ–Ω–∏–π
shap_data_jsr = pd.DataFrame(
    X_test_jsr_preprocessor,
    columns=best_model_feature_names_jsr
)

explainer_jsr = shap.Explainer(
    best_model_jsr.predict,
    shap.sample(shap_data_jsr, 150, random_state=RANDOM_STATE),
)

shap_values_jsr = explainer_jsr(shap_data_jsr[:150])


# In[82]:


# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
show_shap(shap_values_jsr)


# #### –í—ã–≤–æ–¥—ã
# ___
# 
# **–û–±—â–µ–µ**
# >- –î–ª—è –ø–æ–∏—Å–∫–∞ –º–æ–¥–µ–ª–∏ **–±—ã–ª–∏ –≤—ã–±—Ä–∞–Ω—ã –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏: —á–µ—Ä–µ–∑ Randomized Search –∏ Optuna Search**
# >- –ù–∞ –æ—Å–Ω–æ–≤–µ –ª—É—á—à–µ–π –æ—Ü–µ–Ω–∫–∏ CV –±—ã–ª–∞ –æ—Ç–æ–±—Ä–∞–Ω–∞ **–ª—É—á—à–∞—è –º–æ–¥–µ–ª—å Optuna**:
# >  
#             SVR(C=3.349629045654751)
# >  
# >- –ú–µ—Ç—Ä–∏–∫–∞ **SMAPE —É Optuna Search —Å–æ—Å—Ç–∞–≤–∏–ª–∞ `13.7046`**, —á—Ç–æ –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã –º–µ—Ç—Ä–∏–∫–∏ –≤ **`>=15`** –µ–¥–∏–Ω–∏—Ü
# >- **–î–∞–ª–µ–µ –∞–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–∏ SVR Optuna Search**
# 
# **–ê–Ω–∞–ª–∏–∑ Feature Importance**
# > - –°–æ–≥–ª–∞—Å–Ω–æ –∞–Ω–∞–ª–∏–∑—É –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å 4 —Å–∞–º—ã—Ö –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–∞:
# >    - **`num__salary`**
# >    - **`num__supervisor_evaluation`**
# >    - **`ord__level`**
# >    - **`ord__workload`**
# > - –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏–∑ –æ—Ç–¥–µ–ª–∞ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏–º–µ—é —Ç–Ω–∞–∏–±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
# 
# **–ê–Ω–∞–ª–∏–∑ SHAP**
# > **–°–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏**
# > - –†–∞–∑–º–µ—Ä –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç—ã –∏–º–µ–µ—Ç –Ω–∞–∏–±–æ–ª—å—à–∏–π –≤–∫–ª–∞–¥ –≤ –º–æ–¥–µ–ª—å –∏ –æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: —á–µ–º –≤—ã—à–µ –∑–∞—Ä–ø–ª–∞—Ç–∞, —Ç–µ–º –≤—ã—à–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å
# > - –£—Ä–æ–≤–µ–Ω—å –≥—Ä–µ–π–¥–∞, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã, –æ—Ü–µ–Ω–∫–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º —Ç–∞–∫–∂–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
# > - –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Ö–æ—Ç—å –∏ –∏–º–µ—é—Ç –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –Ω–æ –æ–Ω–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
# >
# > **–•–∞—Ä–∞–∫—Ç–µ—Ä –≤–ª–∏—è–Ω–∏—è**
# > - –†–∞–∑–º–µ—Ä –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç—ã —Å–∏–ª—å–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: –≤—ã—à–µ –∑–∞—Ä–ø–ª–∞—Ç–∞ - –≤—ã—à–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç, —Ö–æ—Ç—å –∏ –ø–æ –≥—Ä–∞—Ñ–∏–∫—É –≤–∏–¥–Ω–æ, —á—Ç–æ –≤ —Ü–µ–ª–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ +- –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –≤–¥–æ–ª—å –≤—Å–µ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
# > - –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã —Ç–∞–∫–∂–µ —Å–∏–ª—å–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è –æ—Ü–µ–Ω–∫–∞ - –≤—ã—Å–æ–∫–∞—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç
# > - –í—ã—Å–æ–∫–∏–π –≥—Ä–µ–π–¥ –≤–ª–∏—è–µ—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, –≤ —Ç–æ –∂–µ –≤—Ä–µ–º—è –Ω–∏–∑–∫–π–∏ –≥—Ä–µ–π–¥ - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å, –≤–µ—Ä–æ—è—Ç–Ω–æ, –æ–± —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å–æ—Å—Ç–æ–≤–ª—è—é—â–µ–π –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Å–≤–æ–∏—Ö –Ω–∞–≤—ã–∫–∞—Ö –∏ –∑–Ω–∞–Ω–∏—è—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
# > - –í—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å –≤–ª–∏—è–µ—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ, –Ω–∏–∑–∫–∞—è - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ. –í–µ—Ä–æ—è—Ç–Ω–æ, —á—Ç–æ –Ω–∞–ª–∏—á–∏–µ –∑–∞–¥–∞—á –∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ –æ–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–≥–Ω–∏–∫–æ–≤ –∏ –æ—â—É—â–µ–Ω–∏–µ –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –Ω–∏–∑–∫–∞—è –º–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ —Å–∫—É–∫–µ –∏ –æ—â—É—â–µ–Ω–∏—é –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏
# > - –ü–æ –æ—Å—Ç–∞–ª—å–Ω—ã–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º —è–≤–Ω–æ–π –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è
# >
# > **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫**
# > 
# > –ü—Ä–∏–º–µ—Ä –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø–æ–∫–∞–∑–∞–ª –Ω–∏–∑–∫—É—é —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–ª—É—á–∞–µ –Ω–∏–∑–∫–æ–π –∑–∞—Ä–ø–ª–∞—Ç—ã –∏  –Ω–∏–∑–∫–æ–π –æ—Ü–µ–Ω–∫–∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞. –¢–∞–∫ –∂–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –≤ –∫–æ–º–ø–∞–Ω–∏–∏
# >
# > –ü—Ä–∏ —ç—Ç–æ–º –æ—á–µ–Ω—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–≤–ª–∏—è–ª–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Ä–∞–±–æ—Ç–µ –∏ —É—Ä–æ–≤–µ–Ω—å –≥—Ä–µ–π–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞. –¢–∞–∫–∂–µ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∞–∫—Ç —Ä–∞–±–æ—Ç—ã –≤ –æ—Ç–¥–µ–ª–µ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π, —á—Ç–æ, –≤–æ–∑–º–æ–∂–Ω–æ, –≥–æ–≤–æ—Ä–∏—Ç –æ –±–æ–ª–µ–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —Ç—Ä—É–¥–∞ –∏–º–µ–Ω–Ω–æ –≤ —ç—Ç–∏—Ö –æ—Ç–¥–µ–ª–∞—Ö
# >
# > –û—Å—Ç–∞–ª—å–Ω—ã–µ –∂–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –Ω–µ –Ω–µ—Å—É—Ç –æ—Å–æ–±–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
# >
# > **–û–±—â–∞—è —Å–≤–æ–¥–∫–∞**
# >
# > –ì—Ä–∞—Ñ–∏–∫–∏ SHAP –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –Ω–∞–∏–±–æ–ª—å—à–µ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—É—é —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –æ–∫–∞–∑—ã–≤–∞—é—Ç: 
# > - –∑–∞—Ä–ø–ª–∞—Ç–∞
# > - –≥—Ä–µ–π–¥
# > - –∑–∞–Ω—è—Ç–æ—Å—Ç—å
# > - –æ—Ü–µ–Ω–∫–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è
# >
# > –î—Ä—É–≥–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–º–µ—é—Ç –º–µ–Ω—å—à–µ–µ, –∏–Ω–æ–≥–¥–∞ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ

# ### –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
# ___

# #### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

# In[83]:


# –§–æ—Ä–º–∏—Ä—É–µ–º –≤—ã–±–æ—Ä–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
test_data_quit, train_data_quit = (
    test_features_cleaned.copy().merge(test_target_quit_cleaned, on='id'),
    train_quit_cleaned.copy()
)

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ –ø–æ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
test_data_quit['jsr_predict'] = optuna_best_pipeline_jsr.predict(test_data_quit)
train_data_quit['jsr_predict'] = optuna_best_pipeline_jsr.predict(train_data_quit)


# #### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º—É–ª—å—Ç–∏–∫–æ–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç–∏: –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑

# ##### –¢–µ—Å—Ç–æ–≤–∞—è –≤—ã–±–æ—Ä–∫–∞ `test_data_quit`

# In[84]:


# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–±—â–µ–π –º–∞—Ç—Ä–∏—Ü—ã –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
# –û—Ç–±–æ—Ä –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã—Ö –≤–µ–ª–∏—á–∏–Ω –¥–ª—è –º–∞—Ç—Ä–∏—Ü—ã
test_data_quit_interval_cols = (
    test_data_quit
    .drop(['employment_years', 'supervisor_evaluation'], axis=1)
    .select_dtypes(exclude=['category', object])
    .columns
)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã
test_data_quit_corr_matrix = (
    test_data_quit
    .phik_matrix(interval_cols=test_data_quit_interval_cols)
)

test_data_quit_corr_mask = np.triu(
    np.ones(test_data_quit_corr_matrix.shape),
    k=1
)

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã
show_corr_heatmap_plot(
    test_data_quit_corr_matrix,
    test_data_quit_corr_mask
)


# ##### –¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—á–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ `train_data_quit`

# In[85]:


# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–±—â–µ–π –º–∞—Ç—Ä–∏—Ü—ã –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
# –û—Ç–±–æ—Ä –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã—Ö –≤–µ–ª–∏—á–∏–Ω –¥–ª—è –º–∞—Ç—Ä–∏—Ü—ã
train_data_quit_interval_cols = (
    train_data_quit
    .drop(['employment_years', 'supervisor_evaluation', ], axis=1)
    .select_dtypes(exclude=['category', object])
    .columns
)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã
train_data_quit_corr_matrix = (
    train_data_quit
    .phik_matrix(interval_cols=train_data_quit_interval_cols)
)

train_data_quit_corr_mask = np.triu(
    np.ones(train_data_quit_corr_matrix.shape),
    k=1
)

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã
show_corr_heatmap_plot(
    train_data_quit_corr_matrix,
    train_data_quit_corr_mask
)


# In[86]:


# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–æ–∫
X_train_quit, y_train_quit, X_test_quit, y_test_quit = (
    train_data_quit.drop('quit', axis=1),
    train_data_quit.quit,
    test_data_quit.drop('quit', axis=1),
    test_data_quit.quit
)

get_samples_shape_info(
    X_train_quit, 
    X_test_quit,
    y_train_quit,
    y_test_quit
)


# In[87]:


# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏
label_encoder = LabelEncoder()
y_train_quit = label_encoder.fit_transform(y_train_quit)
y_test_quit = label_encoder.transform(y_test_quit)


# In[88]:


pipeline_params_quit = {
    'task': 'clf',
    'ohe_columns': ohe_columns,
    'ord_columns': ord_columns,
    'num_columns': num_columns,
    'ord_categories': ord_categories,
}

final_pipeline_quit = build_pipeline(**pipeline_params_quit)


# #### –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

# In[89]:


# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Dummy –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ–ª–µ–π –Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å
dummy_quit = DummyClassifier(strategy='most_frequent')
dummy_quit.fit(X_train_quit, y_train_quit)


# In[90]:


# –ü–æ–∏—Å–∫ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ RandomizedSearch
randomized_param_grid_quit = construct_param_grid_sklearn('clf')

rs_results_list = []
rs_best_pipeline_quit = None
rs_best_pipeline_quit_name = None
rs_best_pipeline_cv_score_quit = 0

cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=RANDOM_STATE)

for param_dist in tqdm(randomized_param_grid_quit, desc='RSCV Progress'):    
    rs_searcher = get_searcher(
        final_pipeline_quit,
        param_dist,
        search_method='randomized',
        scoring='roc_auc',
        cv=cv
    )

    with tqdm(total=1, desc=f'{param_dist["model"][0].__class__.__name__}') as pbar:
        rs_searcher.fit(X_train_quit, y_train_quit)
        
        pbar.update(1)
        pbar.set_postfix({'Best CV': f'{rs_searcher.best_score_:.4f}'})
            
    cv_score = rs_searcher.best_score_
    
    rs_results_list.append({
        'Best Model': rs_searcher.best_estimator_.named_steps.model,
        'Best CV': f'{cv_score:.4f}',
        'Train Time (sec.)': f'{rs_searcher.refit_time_:.2f}',
        'Pred Time (sec.)': f'{rs_searcher.cv_results_["mean_score_time"][rs_searcher.best_index_]:.2f}',
        'Method': 'RSCV'

    })
    
    if cv_score > rs_best_pipeline_cv_score_quit:
        rs_best_pipeline_quit = rs_searcher.best_estimator_
        rs_best_pipeline_cv_score_quit = cv_score


# In[91]:


# –ü–æ–∏—Å–∫ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ Optuna Search
os_results_list = []
optuna_best_pipeline_quit = None
optuna_best_pipeline_quit_name = None
optuna_best_pipeline_cv_score_quit = 0

optuna_param_grid_quit = construct_param_grid_optuna('clf')

for model_key, dist in tqdm(optuna_param_grid_quit.items(), 'OSCV Progress'):
    model_name = dist['model'].choices[0].__class__.__name__
            
    optuna_searcher = get_searcher(
        final_pipeline_quit,
        dist,
        search_method='optuna',
        scoring='roc_auc',
        cv=cv
    )
    
    with tqdm(total=1, desc=f'{model_name}') as pbar:
        optuna_searcher.fit(X_train_quit, y_train_quit)
        
        pbar.update(1)
        pbar.set_postfix({'Best CV': f'{optuna_searcher.best_score_:.4f}'})
    
    cv_score = optuna_searcher.best_score_
    os_best_model_name = optuna_searcher.best_estimator_.named_steps.model.__class__.__name__
    
    os_results_list.append({
        'Best Model': f'{optuna_searcher.best_estimator_.named_steps.model}',
        'Best CV': f'{cv_score:.4f}',
        'Train Time (sec.)': f'{optuna_searcher.refit_time_:.2f}',
        'Pred Time (sec.)': f'{optuna_searcher.cv_results_["mean_score_time"][optuna_searcher.best_index_]:.2f}',
        'Method': 'OSCV'
    })
    
    if cv_score > optuna_best_pipeline_cv_score_quit:
        optuna_best_pipeline_quit = optuna_searcher.best_estimator_
        optuna_best_pipeline_cv_score_quit = cv_score


# In[92]:


# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
quit_full_results_list = pd.concat([
    pd.DataFrame(rs_results_list),
    pd.DataFrame(os_results_list)
]).sort_values('Best CV', ascending=False).reset_index(drop=True)

quit_full_results_list.style.background_gradient(cmap=PALETTE_NUMERIC, subset=['Best CV'])


# In[93]:


# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ–ª–µ–π –Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å Dummy
y_test_dummy_quit_pred = dummy_quit.predict(X_test_quit)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
y_test_quit_pred_proba = rs_best_pipeline_quit.predict_proba(X_test_quit)[:, 1]

# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞—Å—á–µ—Ç—ã –º–µ—Ç—Ä–∏–∫
main_metrics = {
    'CV': rs_best_pipeline_cv_score_quit,
    'ROC_AUC': roc_auc_score(y_test_quit, y_test_quit_pred_proba),
}

dummy_metrics = {
    'CV': '-',
    'ROC_AUC': roc_auc_score(y_test_quit, y_test_dummy_quit_pred)
}

best_model_metrics = pd.DataFrame(
    data=[main_metrics, dummy_metrics],
    index=['Best Model', 'Dummy Baseline']
)

# –í—ã–≤–æ–¥ –º–µ—Ç—Ä–∏–∫
display(Markdown(f'### –ú–µ—Ç—Ä–∏–∫–∏ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ \n___'))
display(rs_best_pipeline_quit.named_steps.model)
display(pd.DataFrame(best_model_metrics).T)


# #### –ê–Ω–∞–ª–∏–∑ –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

# In[94]:


# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–º—É—Ç–∞—Ü–∏–æ–Ω–Ω–æ–π –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
best_model_quit = rs_best_pipeline_quit.named_steps.model
best_model_preprocessor_quit = rs_best_pipeline_quit.named_steps.preprocessor
best_model_feature_names_quit = best_model_preprocessor_quit.get_feature_names_out()
X_test_quit_preprocessor = best_model_preprocessor_quit.transform(X_test_quit)

permutation_result_quit = permutation_importance(
    best_model_quit,
    X_test_quit_preprocessor,
    y_test_quit,
    scoring='roc_auc',
    n_repeats=10
)


# In[95]:


# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
feature_importance_quit = pd.DataFrame({
    'name': best_model_feature_names_quit,
    'value': permutation_result_quit.importances_mean,
    })

show_feature_importance_bar(feature_importance_quit)


# In[96]:


# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ SHAP-–∑–Ω–∞—á–µ–Ω–∏–π
quit_data = pd.DataFrame(
    X_test_quit_preprocessor,
    columns=best_model_feature_names_quit
)
                    
explainer_quit = shap.Explainer(
    best_model_quit.predict_proba,
    shap.sample(quit_data, 150, random_state=RANDOM_STATE)
)

shap_values_quit = explainer_quit(quit_data[:150])


# In[97]:


# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
show_shap(shap_values_quit[..., 1])


# #### –í—ã–≤–æ–¥—ã
# ---
# **–û–±—â–µ–µ**
# >- –í —Ä–∞–º–∫–∞—Ö –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞–ª **–æ—Ç—Å—Ç—É—Ç—Å—Ç–≤–∏–µ –º—É–ª—å—Ç–∏–∫–æ–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç–∏**
# >- –î–ª—è –ø–æ–∏—Å–∫–∞ –º–æ–¥–µ–ª–∏ **–±—ã–ª–∏ –≤—ã–±—Ä–∞–Ω—ã –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏: —á–µ—Ä–µ–∑ Randomized Search –∏ Optuna Search**
# >- –ù–∞ –æ—Å–Ω–æ–≤–µ –ª—É—á—à–µ–π –æ—Ü–µ–Ω–∫–∏ CV –±—ã–ª–∞ –æ—Ç–æ–±—Ä–∞–Ω–∞ **–ª—É—á—à–∞—è –º–æ–¥–µ–ª—å Randomized Search** —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
# >  
#         SVC(C=10, class_weight='balanced', gamma='auto', probability=True, random_state=42)
# >  
# >- **–í –∫–∞—á–µ—Å—Ç–≤–µ –º–µ—Ç—Ä–∏–∫–∏ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ ROC-AUC**, —Ç.–∫. –Ω–∞–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤–∞–∂–Ω—ã –∫–∞–∫ Recall, —Ç–∞–∫ –∏ Precision
# >- –ú–µ—Ç—Ä–∏–∫–∞ **ROC-AUC —Å–æ—Å—Ç–≤–∞–∏–ª–∞ `0.9230`**, —á—Ç–æ –≤ —Ü–µ–ª–æ–º –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —è–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
# >- **–î–∞–ª–µ–µ –∞–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–∏ SV–° Randomized Search**
# 
# **–ê–Ω–∞–ª–∏–∑ Feature Importance**
# > - –°–æ–≥–ª–∞—Å–Ω–æ –∞–Ω–∞–ª–∏–∑—É –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å 4 —Å–∞–º—ã—Ö –Ω–∞–∏–±–æ–ª–µ–µ –≤–ª–∏—è—Ç–µ–ª–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–∞:
# > > - **`ord__level`**
# > > - **`remainder__jsr_predict`**
# > > - **`num__employment_years`**
# > > - **`ord__workload`**
# > - –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏–∑ –æ—Ç–¥–µ–ª–∞ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ –ü—Ä–æ–¥–∞–∂ –±–æ–ª–µ–µ –º–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã –ø–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º –£–≤–æ–ª—å–Ω–µ–Ω–∏—è
# 
# **–ê–Ω–∞–ª–∏–∑ SHAP**
# > **–°–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏**
# > - –£—Ä–æ–≤–µ–Ω—å –≥—Ä–µ–π–¥–∞ –æ –ø—Ä–∏–≤–Ω–æ—Å–∏—Ç –Ω–∞–∏–±–æ–ª—å—à–∏–π –≤–∫–ª–∞–¥ –≤ –º–æ–¥–µ–ª—å –∏ –æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è
# > - –¢–∞–∫–∂–µ –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –æ–∫–∞–∑—ã–≤–∞—é—Ç –≤–ª–∏—è–Ω–∏–µ - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Ä–∞–±–æ—Ç–µ
# > - –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Ö–æ—Ç—å –∏ –∏–º–µ—é—Ç –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–≤–æ–ª—å–Ω–µ–Ω–∏—è, –Ω–æ –æ–Ω–∏ –Ω–µ —Å—Ç–æ–ª—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã
# >
# > **–•–∞—Ä–∞–∫—Ç–µ—Ä –≤–ª–∏—è–Ω–∏—è**
# > - –ü–æ —É—Ä–æ–≤–Ω—é –≥—Ä–µ–π–¥–∞ –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–º –≥—Ä–µ–π–¥–æ–º –±–æ–ª–ª–µ–µ –ø—Ä–µ–¥—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –∫ —É–≤–æ–ª—å–Ω–µ–Ω–∏—é. –í–µ—Ä–æ—è—Ç–Ω–æ, —ç—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ–± –∏—Ö —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Å–≤–æ–∏—Ö –Ω–∞–≤—ã–∫–∞—Ö –∏ –∑–Ω–∞–Ω–∏—è—Ö –∏ –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ —Ä—ã–Ω–∫–µ —Ç—Ä—É–¥–∞, –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ –∏ –æ–±—Ä–∞—Ç–Ω–æ–µ
# > - –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, –æ—á–µ–≤–∏–¥–Ω–æ, –±—É–¥–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–≤–æ–ª—å–Ω–µ–Ω–∏—è, —Ç.–∫. –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω—ã–π —á–µ–º-–ª–∏–±–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ —Å—Ç–∞–Ω–µ—Ç –¥–æ–ª–≥–æ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –Ω–∞ —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—Ç–µ
# >
# > **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫**
# >
# > –ö–∞—Ä—Ç–∏–Ω–∞ –Ω–∞ –∏–Ω–¥–∏–≤–∏–¥—É–ª—å–Ω–æ–º –ø—Ä–∏–∑–Ω–∞–∫–æ –ø–æ—á—Ç–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ç–µ –≤—ã–≤–æ–¥, —á—Ç–æ —Å–¥–µ–ª–∞–Ω—ã –≤—ã—à–µ –ø–æ –¥—Ä—É–≥–∏–º –≥—Ä–∞—Ñ–∏–∫–∞–º SHAP: –≥—Ä–µ–π–¥, –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, –æ–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–º–µ—é—Ç —Å–∏–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–≤–æ–ª—å–Ω–µ–Ω–∏—è
# >
# > –ü—Ä–∏ —ç—Ç–æ–º –æ—Ç–¥–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤–ª–∏—è–Ω–∏–µ —Ä–∞–∑–º–µ—Ä –∑–∞—Ä–ø–ª–∞—Ç—ã –∏ –æ—Ü–µ–Ω–∫–∞ —Ä–∞–±–æ—Ç—ã, –∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ—Ç–¥–µ–ª–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ –º–µ–Ω–µ–µ –ø—Ä–µ–¥—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –∫ —É–≤–æ–ª—å–Ω–µ–Ω–∏—é
# >
# > **–û–±—â–∞—è —Å–≤–æ–¥–∫–∞**
# >
# > –ì—Ä–∞—Ñ–∏–∫–∏ SHAP –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –Ω–∞–∏–±–æ–ª—å—à–µ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—É—é —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –æ–∫–∞–∑—ã–≤–∞—é—Ç: 
# > - –≥—Ä–µ–π–¥
# > - —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å
# > - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã
# > - –∑–∞–≥—Ä—É–∑–∫–∞
# >
# > –î—Ä—É–≥–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–º–µ—é—Ç –º–µ–Ω—å—à–µ–µ, —á–∞—Å—Ç–æ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ

# ## –û—Ç–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ —Å–µ–≥–º–µ–Ω—Ç–∞
# ___

# ### –°–µ–≥–º–µ–Ω—Ç: –ù–∏–∑–∫–∞—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ –≤—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–≤–æ–ª—å–Ω–µ–Ω–∏—è

# In[98]:


# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
segment_data = train_data_quit.copy().drop(columns='quit', axis=1)

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ –ø–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü—É
segment_data['jsr_predict'] = optuna_best_pipeline_jsr.predict(segment_data)
segment_data['quit_predict'] = rs_best_pipeline_quit.predict_proba(segment_data)[:, 1]

# –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–≤—ã—à–µ–Ω–∏–π –∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π
segment_data = pd.get_dummies(segment_data, columns=['last_year_promo', 'last_year_violations'])

# –û—Ç–±–æ—Ä —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º:
# –ù–∏–∑–∫–∞—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç—å: ‚â§ 0.4 (—á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º —Ö—É–∂–µ)
# –í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–≤–æ–ª—å–Ω–µ–Ω–∏—è: ‚â• 0.6 (—á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º –≤—ã—à–µ —Ä–∏—Å–∫)
high_risk_segment = segment_data.query('jsr_predict <= 0.4 & quit_predict >= 0.6')
low_risk_segment = segment_data.drop(high_risk_segment.index)

high_risk_segment.attrs['name'] = 'high_risk_segment'
low_risk_segment.attrs['name'] = 'low_risk_segment'

segment_discrete_features = [
    'workload',
    'level',
    'dept',
    'supervisor_evaluation',
    'employment_years',
    'last_year_promo_no',
    'last_year_promo_yes', 
    'last_year_violations_no', 
    'last_year_violations_yes'
]

get_df_overview(
    high_risk_segment,
    segment_discrete_features
)
get_df_overview(
    low_risk_segment,
    segment_discrete_features
)


# In[99]:


# –í—ã–≤–æ–¥ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
def dept_agg(df):
    return pd.Series({
        '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (–≤—Å–µ–≥–æ)': len(df),
        '–ì—Ä–µ–π–¥ (–º–æ–¥–∞)': df['level'].mode()[0],
        '–ó–∞—Ä–ø–ª–∞—Ç–∞ (–º–µ–¥–∏–∞–Ω–∞)': np.median(df['salary']),
        '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å—Ä)': np.round(np.mean(df['employment_years']), 1),
        '–û—Ü–µ–Ω–∫–∞ (–º–æ–¥–∞)': df['supervisor_evaluation'].mode()[0],
        '–ó–∞–≥—Ä—É–∑–∫–∞ (–º–æ–¥–∞)': df['workload'].mode()[0],
        '–ü–æ–≤—ã—à–µ–Ω–∏–π (%)': np.round(df['last_year_promo_yes'].mean()*100, 1),
        '–ù–∞—Ä—É—à–µ–Ω–∏–π (%)': np.round(df['last_year_violations_yes'].mean()*100, 1),
        '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å (—Å—Ä)': np.round(df['jsr_predict'].mean(), 2),
        '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–≤–æ–ª—å–Ω–µ–Ω–∏—è (—Å—Ä)': np.round(df['quit_predict'].mean(), 2),
    })

high_risk_dept = (
    high_risk_segment
    .groupby('dept')
    .apply(dept_agg)
    .reset_index()
    .rename(columns={'dept': '–û—Ç–¥–µ–ª'})
)


low_risk_dept = (
    low_risk_segment
    .groupby('dept')
    .apply(dept_agg)
    .reset_index()
    .rename(columns={'dept': '–û—Ç–¥–µ–ª'})
)


# In[100]:


display(high_risk_dept, low_risk_dept)


# In[101]:


# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—ç–∏—Ä–ø–ª–æ—Ç–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤
high_risk_dept['–°–µ–≥–º–µ–Ω—Ç'] = '–¶–µ–ª–µ–≤–æ–π'
low_risk_dept['–°–µ–≥–º–µ–Ω—Ç'] = '–ù–µ—Ü–µ–ª–µ–≤–æ–π'

merged = pd.concat([high_risk_dept, low_risk_dept])

sns.pairplot(merged, hue='–°–µ–≥–º–µ–Ω—Ç', corner=True)
plt.tight_layout()
plt.show()


# ### –í—ã–≤–æ–¥—ã
# ---
# –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–≤ –¥–∞–Ω–Ω—ã–µ –∏ –≥—Ä–∞—Ñ–∏–∫ –ø–æ —Ü–µ–ª–µ–≤–æ–º—É —Å–µ–≥–º–µ–Ω—Ç—É —Å–∞–º—ã—Ö –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –≤—ã—Å–æ–∫–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é —É–≤–æ–ª—å–Ω–µ–Ω–∏—è, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–≤–æ–¥—ã –ø–æ —Å–µ–≥–º–µ–Ω—Ç—É:
# - –û—Ç–¥–µ–ª—ã –ø—Ä–æ–¥–∞–∂ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –±–æ–ª—å—à–µ –ø–æ–¥–≤–µ—Ä–∂–µ–Ω—ã —Ä–∏—Å–∫—É —É–≤–æ–ª—å–Ω–µ–Ω–∏—è, –≤ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –∑–æ–Ω–µ —Ä–∏—Å–∫–∞ - 632
# - –û–Ω–∏ –∏–º–µ—é—Ç –±–æ–ª–µ–µ –Ω–∏–∑–∫—É—é –º–µ–¥–∏–∞–Ω–Ω—É—é –∑–∞—Ä–ø–ª–∞—Ç—É
# - –†–∞–±–æ—Ç–∞—é—Ç –≤ –∫–æ–º–ø–∞–Ω–∏–∏ –≤ —Å—Ä–µ–¥–Ω–µ–º –æ—Ç 1.5 –¥–æ 1.8 –ª–µ—Ç
# - –ü–æ–ª—É—á–∞—é—Ç –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏–µ –æ—Ü–µ–Ω–∫–∏ –ø–æ —Ä–∞–±–æ—Ç–µ –æ—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π
# - –ù–µ –∏–º–µ—é—Ç –ø–æ–≤—ã—à–µ–Ω–∏–π –≤–æ–≤—Å–µ
# - –ß–∞—â–µ –≤—Å–µ–≥–æ —Å–æ–≤–µ—Ä—à–∞—é—Ç –¥–æ–ø—É—Å–∫–∞—é—Ç –Ω–∞—Ä—É—à–µ–Ω–∏—è –¢–î
# - –ò –≤ —Å—Ä–µ–¥–Ω–µ–º –º–µ–Ω–µ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã —Ä–∞–±–æ—á–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏

# ## –ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã
# ___
# 
# ### –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã
# ___
# > - –î–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–µ–Ω—ã. –í –¥–∞–Ω–Ω—ã—Ö –Ω–µ –±—ã–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –∏–ª–∏ –≤—ã–±—Ä–æ—Å–æ–≤ –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –æ–¥–Ω–æ–π –æ—à–∏–±–∫–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –≥—Ä–µ–π–¥–∞ –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
# >
# > - –ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ—Ç–æ—Ä–æ–π –±—ã–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –≥—Ä–µ–π–¥–æ–≤ –∏ –∏–∑–º–µ–Ω–µ–Ω—ã —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –±—ã–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã NaN-–∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã —É–∂–µ –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ
# >
# > - –ü—Ä–æ–≤–µ–¥–µ–Ω –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–æ–≤ (—Å –≤—Ö–æ–¥–Ω—ã–º–∏ –∏ —Ü–µ–ª–µ–≤—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏), –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–ª –≤ —Å–µ–±—è –∫–æ—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –∞–Ω–∞–ª–∏–∑ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö. –û—Ç–µ–¥–ª—å–Ω–æ –ø—Ä–æ–≤–µ–¥–µ–Ω –∞–Ω–∞–ª–∏–∑ –ø–æ –¥–≤—É–º –ø–æ—Ä—Ç—Ä–µ—Ç–∞–º - "–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ –æ—Ç–¥–µ–ª—É" –∏ "–£–≤–æ–ª–∏–ª—Å—è –ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫", –∞ —Ç–∞–∫–∂–µ –ø–æ –£—Ä–æ–≤–µ–Ω —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –£–≤–æ–ª–∏–ª—Å—è –ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫. –í —Ü–µ–ª–æ–º –¥–∞–Ω–Ω—ã–µ –≤—ã–≥–ª—è–¥—è—Ç –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–Ω–æ, –≤—ã–±—Ä–æ—Å–æ–≤ –∏ –∞–Ω–æ–º–∞–ª–∏–π –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–µ –±—ã–ª–æ
# >
# > - –ë—ã–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω—ã –∏ –≤—ã–±—Ä–∞–Ω—ã **–ª—É—á—à–∏–µ ML-–º–æ–¥–µ–ª–∏ –¥–ª—è –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —É—Ä–æ–≤–Ω—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –≤–µ—Ä–æ—Ç–Ω–æ—Å—Ç–∏ —É—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞**. –î–ª—è –ø–æ–∏—Å–∫–∞ –æ–±–µ–∏—Ö –º–æ–¥–µ–ª–µ–π –±—ã–ª–∏ –≤—ã–±—Ä–∞–Ω—ã –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ –æ–±—É—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø–∞–π–ø–ª–∞–π–Ω: Randomized Search –∏ Optuna Search. –í –∫–∞—á–µ—Å—Ç–≤–µ –ª—É—á—à–∏—Ö –º–æ–¥–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ü–µ–Ω–æ–∫ CV –±—ã–ª–∏ –æ—Ç–æ–±—Ä–∞–Ω—ã:
# > >
# > > –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:
# > > 
# > > **`Optuna Search - SVR(C=3.349629045654751)`**
# > >
# > > –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—é –≤–µ—Ä–æ—Ç–Ω–æ—Å—Ç–∏ —É—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:
# > > 
# > > **`Randomized Search - SVC(C=10, class_weight='balanced', gamma='auto', probability=True, random_state=42)`**
# >
# > - –ü—Ä–æ–≤–µ–¥–µ–Ω –∞–Ω–∞–ª–∏–∑ –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑–∞–ª –Ω–∞–∏–±–æ–ª–µ–µ –≤–ª–∏—è—Ç–µ–ª—å–Ω—ã–µ –∏–∑ –Ω–∏—Ö:
# > > **–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤**:\
# > > `'num__salary', 'ord__level', 'ord__workload', 'num__supervisor_evaluation'`
# > > 
# > > **–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≤–µ—Ä–æ—Ç–Ω–æ—Å—Ç–∏ —É—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞**:\
# > > `'ord__level', 'remainder__jsr_predict', 'num__employment_years', 'ord__workload'`
# > >
# > > –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –º–µ—Ç–æ–¥–∞ SHAP —Ç–∞–∫–∂–µ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —è–≤–ª—è—é—Ç—Å—è –Ω–∞–∏–±–æ–ª–µ–µ –≤–ª–∏—è—Ç–µ–ª—å–Ω—ã–º–∏ –≤ –∫–∞–∂–¥–æ–º –∏–∑ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π
# >
# > - –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –±—ã–ª–∏ —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Å–∞–º—ã–º –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω—ã–º —Ä–∞–±–æ—Ç–æ–π –∏ —Å –≤—ã—Å–æ–∫–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é —É–≤–æ–ª—å–Ω–µ–Ω–∏—è, –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —á–µ–≥–æ –±—ã–ª–∏ –≤—ã—è–≤–ª–µ–Ω—ã –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥—É—Ç –¥–∞–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∏–∂–µ
# 
# 
# ### –ì–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
# ___
# **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–≤–µ–ª–∏—á–µ–Ω–∏—é —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏**
# 
# > –ú–æ–¥–µ–ª—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ–∫–∞–∑–∞–ª–∞, —á—Ç–æ —Ö–æ—Ä–æ—à–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞, —É—Ä–æ–≤–µ–Ω—å –≥—Ä–µ–π–¥–∞, –≤—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —Ö–æ—Ä–æ—à–∞—è –æ—Ü–µ–Ω–∫–∞ –æ—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –Ω–µ–µ –Ω–∞–∏–±–æ–ª—å—à–µ–µ –≤–ª–∏—è–Ω–∏–µ
# >
# > –ò—Å—Ö–æ–¥—è –∏–∑ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:
# > - –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —É—Ä–æ–≤–µ–Ω—å –¥–æ—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∏—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ä—ã–Ω–∫–æ–º, –ø—Ä–æ–≤–æ–¥–∏—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –∏ –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—É —Ö–æ—Ç—è –±—ã —Ä–∞–∑ –≤ –≥–æ–¥
# >   
# > - –î–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –∏ –Ω–∞–≥—Ä—É–∑–∫—É –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏ —Å –≥—Ä–µ–π–¥–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞. –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –∑–æ–ª–æ—Ç—É—é —Å–µ—Ä–µ–¥–∏–Ω—É, —á—Ç–æ–±—ã –∏ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –∏—Ö —Ä–∞–±–æ—Ç–æ–π –∏, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∞–ª—Å—å –º–æ—Ç–∏–≤–∞—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã. –°—Ç–æ–∏—Ç –≤–≤–µ—Å—Ç–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –∏ —Ä–æ—Å—Ç–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–∞–Ω–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–ø–ª–∞—á–∏–≤–∞–µ–º–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫—É—Ä—Å—ã –æ—Ç —Ç–æ–ø–æ–≤
# >
# > - –ù—É–∂–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ, –∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—Ü–µ–Ω–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ –ø–æ –∫–∞–∫–∏–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º. –Ø–≤–Ω–æ, –µ—Å–ª–∏ –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —á–∞—Å—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç –Ω–∏–∑–∫–∏–µ –æ—Ü–µ–Ω–∫–∏, —ç—Ç–æ –±—É–¥–µ—Ç —Å–∏–ª—å–Ω–æ –¥–µ–º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å. –í–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ü–µ–Ω–∫–∏ –≤ —Ñ–æ—Ä–º—Ç–∞–µ one-to-one, –∫–æ—Ç–æ—Ä–∞—è –±—ã –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–ª–∞ —Ç–æ–ª—å–∫–æ –∏—Ö —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã, –∞ —Å–ª–∞–±—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–ª–∞, –∫–∞–∫ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è —Ä–æ—Å—Ç–∞
# >
# > - –ò, –∫–∞–∫ –∏—Ç–æ–≥, —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ —ç—Ç–æ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–º –¥–ª—è –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–∏–∫–∏ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –≥–¥–µ –±—É–¥–µ—Ç —Ä–∞–∑–º–µ—â–µ–Ω–∞ –≤—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ –≤—Å–µ–π –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
# 
# **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–¥–µ—Ä–∂–∞–Ω–∏—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤**
# 
# > –ú–æ–¥–µ–ª—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ–∫–∞–∑–∞–ª–∞, —á—Ç–æ —É—Ä–æ–≤–µ–Ω—å –≥—Ä–µ–π–¥–∞, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –∏ –Ω–∞–≥—Ä—É–∑–∫–∞ –æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞–∏–±–æ–ª—å—à–µ–µ –≤–ª–∏—è–Ω–∏–µ
# > 
# > –ò—Å—Ö–æ–¥—è –∏–∑ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:
# > - –ü–æ —É—Ä–æ–≤–Ω—é –≥—Ä–µ–π–¥–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –º–æ–≥—É—Ç –æ—Å—Ç–∞—Ç—å—Å—è —Ç–µ–º–∏ –∂–µ: –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å–º–æ—Ç—Ä –∑–∞–¥–∞—á, –Ω–∞–≥—Ä—É–∑–∫–∏, –∑–∞–ø—Ä–ø–ª–∞—Ç. –ù–æ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –º–æ–≥–ª–æ –±—ã –∫–∞—Å–∞—Ç—å—Å—è –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å —Å–∞–º—ã—Ö —Ü–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –≤—ã—Å–æ–∫–∏–º –≥—Ä–µ–π–¥–æ–º, —Ç.–∫. –æ–Ω–∏ –ø–æ—Å—Ç-—Ñ–∞–∫—Ç—É–º —Ü–µ–Ω–Ω—ã–µ –∫–∞–¥—Ä—ã –Ω–∞ —Ä—ã–Ω–∫–µ —Ç—Ä—É–¥–∞ –∏ –Ω–µ –∏–º–µ—é—Ç –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–∏—Å–∫–æ–º —Ä–∞–±–æ—Ç—ã, –ø–æ—ç—Ç–æ–º—É –∏—Ö —Ç—è–∂–µ–ª–æ —É–¥–µ—Ä–∂–∞—Ç—å –æ–±—ã—á–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–æ–∏—Ç –≤—ã—Ä–∞–±–æ—Ç–∞—Ç—å –∫ –∫–∞–∂–¥–æ–º—É –∏–∑ –Ω–∏—Ö –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–ª—é—à–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –î–ú–°, –ø–∏—Ç–∞–Ω–∏–µ –∑–∞ —Å—á–µ—Ç –∫–æ–º–ø–∞–Ω–∏–∏, –æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã–µ –∫—É—Ä—Å—ã –∏–ª–∏ –¥–∞–∂–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, —Å–∫–∏–¥–∫–∏ –Ω–∞ –∏–ø–æ—Ç–µ–∫—É, –ø—Ä–µ–º–∏–∏, —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–æ–æ—â—Ä–µ–Ω–∏—è –∏ –º–µ—Ä—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ —Å–ª—É—á–∞–µ —Ç—Ä—É–¥–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π –∏ –¥—Ä.
# >   
# > - –û–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–ø–æ—Å—Ä–µ–¥–æ–≤–∞–Ω–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ, —Ç.–∫. –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –ª—é–¥—è–º —Å–≤–æ–π—Å—Ç–≤–µ–Ω–Ω–æ –º–µ–Ω—è—Ç—å —Ä–∞–±–æ—Ç—É —Ä–∞–∑ –≤ 3 –≥–æ–¥–∞, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –æ–Ω–∏ –º–æ–ª–æ–¥—ã–µ. –ß–µ–º –±–æ–ª—å—à–µ —á–µ–ª–æ–≤–µ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∫–æ–º–ø–∞–Ω–∏–∏ - —Ç–µ–º –±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ, —á—Ç–æ –æ–Ω —Å–º–µ–Ω–∏—Ç —Ä–∞–±–æ—Ç—ã, —Ç–æ –∂–µ –∏ –≤–µ—Ä–Ω–æ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–æ 1 –≥–æ–¥–∞. –ï—Å–ª–∏ –≤ –ø–µ—Ä–≤–æ–º —Å–ª—É—á–∞–µ - —ç—Ç–æ –∏–∑-–∑–∞ –∂–µ–ª–∞–Ω–∏—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–æ—Å—Ç–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏—è, —Ç–æ –≤–æ –≤—Ç–æ—Ä–æ–º - –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫–∞–∫–∏—Ö-–ª–∏–±–æ –Ω—É–∂–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤, –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∑–∞–≥—Ä—É–∑–∫–µ –∏–ª–∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ –≤ –∫–æ–ª–ª–µ–∫—Ç–∏–≤–µ. –¢—É—Ç –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–æ—á–µ—á–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã. –î–ª—è –±–æ–ª–µ–µ –º–æ–ª–æ–¥—ã—Ö –∏ –Ω–µ–æ–ø—ã—Ç–Ω—ã—Ö - —á–µ—Ç–∫—É—é —Å–∏—Å—Ç–µ–º—É –∞–¥–∞–ø—Ç–∞—Ü–∏–∏, –≤–µ–ª–∫–æ–º –ø–∞–∫–∏ –ø—Ä–∏ –ø—Ä–∏–µ–º–µ –Ω–∞ —Ä–∞–±–æ—Ç—É, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤—ã –∏ —Ç—É—Å–æ–≤–∫–∏ –∏ –¥–æ. –î–ª—è –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö - –ø–æ–¥–æ–π–¥—É—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ —Å –ø–æ–≤—ã—à–µ–Ω–∏–µ–º –≤ –∑–∞—Ä–ø–ª–∞—Ç–µ –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏, –ª–∏–±–æ –¥–∞–≤–∞—Ç—å –±–æ–ª—å—à–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –∑–∞–¥–∞—á –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
# >   
# > - –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ, –∫–∞–∫ –∏ –≤ —Å–ª—É—á–∞–µ —Å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é –≤ —Ü–µ–ª–æ–º
# 
# **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–µ–≥–º–µ–Ω—Ç—É: –ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω –∏ –≤—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–≤–æ–ª—å–Ω–µ–Ω–∏—è**
# > –ù–∞ –¥–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ —Ü–µ–ª–æ–º —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ, —Ç.–∫. –æ–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∑–æ–Ω–µ —Å–∞–º–æ–≥–æ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞. –ò—Å—Ö–æ–¥—è –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ –º–æ–∂–Ω–æ –¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —ç—Ç–∏–º —Å–µ–≥–º–µ–Ω—Ç–æ–º:
# > - –û–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã –∏ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ö, –æ–Ω–∏ –∏–º–µ—é—Ç –≤ –æ–±—â–µ–º —Å–∞–º—É—é –Ω–∏–∑–∫—É—é –∑–∞—Ä–ø–ª–∞—Ç—É –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏
# >   
# > - –ò—Ö –æ—Ü–µ–Ω–∫–∏ –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å–∞–º—ã–º–∏ –Ω–∏–∑–∫–∏–º–∏, —á—Ç–æ —Ç–∞–∫–∂–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∏—Ö –º–æ—Ç–∏–≤–∞—Ü–∏—é. –í–æ–∑–º–æ–∂–Ω–æ —Å—Ç–æ–∏—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥—Ö–æ–¥ –≤ –∏—Ö –æ—Ü–µ–Ω–∫–µ –∏ –ø–æ—Å—Ç–∞—Ä–∞—Ç—å—Å—è –≤—ã—è–≤–∏—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã —ç—Ç–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–º –±–æ–ª–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è - –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥—Ä—É–≥—É—é –¥–æ–ª–∂–Ω–æ—Å—Ç—å, –±–æ–ª–µ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏, –∏–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã
# >   
# > - –ï—â–µ –æ–¥–Ω–æ–π –∑–æ–Ω–æ–π —Ä–∏—Å–∫–∞ —è–≤–ª—è–µ—Ç—Å—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—ã—à–µ–Ω–∏–π –∑–∞ –≥–æ–¥ –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ. –¢—É—Ç –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ —Å—Ç–æ–∏–ª–æ –±—ã –≤–Ω–µ–¥—Ä–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–µ–Ω–∏—è –∏ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º
# >   
# > - –û–Ω–∏ –Ω–∞—Ä—É—à–∞—é—Ç –¢–î –Ω–∞–º–Ω–æ–≥–æ —á–∞—â–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö. –í–µ—Ä–æ—è—Ç–Ω–æ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ –±–æ–ª—å—à–µ —Å –Ω–∏–∑–∫–æ–π —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é, —á—Ç–æ –∏ –ø—Ä–æ–≤–æ—Ü–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è. –°—Ç–æ–∏—Ç –≤—ã—è–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∏ –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å –∏—Ö
# >
# > –ï—Å—Ç—å –±–æ–ª—å—à–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å, —á—Ç–æ —É—Å–∏–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ –∏–∑ –¥–∞–Ω–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤–ª–∏—è–µ—Ç –∏ –Ω–∞ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ —Ü–µ–ª–æ–º
# 
# ### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—é –±–∞–∑—ã
# ___
# > - –í –æ–±—â–µ–º –≤–∏–¥–µ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º—ã –æ–∫–∞–∑–∞–ª–∏—Å—å –æ—á–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∏ —á–∏—Å—Ç—ã–º–∏
# > - –ù–µ–±–æ–ª—å—à–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É –¥–∞—Ç—å - –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –Ω–µ–π–º–∏–Ω–≥–∏ –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–ø—É—Å–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ —É—á–∏—Ç—ã–≤–∞—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —É –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –±–∞–∑—ã

# In[ ]:


get_ipython().system('pip3 install pipreqs -q')
get_ipython().system('pipreqs . --print')
get_ipython().system('jupyter nbconvert --to python *.ipynb')
get_ipython().system('pipreqs')
get_ipython().system('pipreqs . --force')

